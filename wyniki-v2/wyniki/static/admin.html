<!DOCTYPE html>
<html lang="pl" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Administracyjny - Wyniki Live</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>⚙️</text></svg>">
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* 16:9 preview canvas */
    .canvas-outer {
      width: 100%; aspect-ratio: 16/9; background: #0d1117;
      border-radius: 12px; position: relative; overflow: hidden;
      border: 2px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 60px rgba(0,0,0,0.5);
    }
    .canvas-inner {
      width: 1920px; height: 1080px;
      transform-origin: top left; position: absolute; top: 0; left: 0;
    }
    .canvas-grid {
      position: absolute; inset: 0; pointer-events: none;
      background-image:
        linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
      background-size: 192px 108px;
    }
    .canvas-safe {
      position: absolute; left: 5%; top: 5%; right: 5%; bottom: 5%;
      border: 1px dashed rgba(255,255,255,0.06); pointer-events: none;
    }

    /* draggable wrappers inside the 1920x1080 canvas */
    .drag-el {
      position: absolute; cursor: grab; -webkit-user-select: none; -moz-user-select: none; user-select: none; touch-action: none;
      transition: box-shadow 0.15s;
      outline: 2px solid transparent; outline-offset: 2px;
    }
    .drag-el:hover { outline-color: rgba(100,180,255,0.5); }
    .drag-el.is-dragging { cursor: grabbing; outline-color: #4CAF50; z-index: 100; }
    .drag-el.is-selected { outline-color: #2196F3; }
    .drag-el.el-hidden { opacity: 0.15; }

    /* scoreboard – dark grid matching main page */
    .sb-wrap { display:flex; width:100%; align-items:stretch; gap:8px; }
    .sb-wrap.match-inactive .sb-table { opacity:0.4; }
    .sb-logo { flex-shrink:0; display:flex; align-items:center; justify-content:center;
      overflow:hidden; border-radius:6px; }
    .sb-logo img { width:100%; height:100%; -o-object-fit:cover; object-fit:cover; }
    .sb-logo-ph { display:flex; align-items:center; justify-content:center;
      width:100%; height:100%; background:rgba(255,255,255,0.1); border-radius:6px; font-size:22px; }
    .sb-table {
      flex:1; min-width:0; display:grid; gap:0;
      border-radius:14px; overflow:hidden;
      background:linear-gradient(180deg,#1d1d1d 0%,#090909 100%);
      box-shadow:0 12px 24px rgba(0,0,0,0.35);
      border:1px solid rgba(0,0,0,0.8);
    }
    .sb-row { display:grid; align-items:stretch; color:#fdfdfd; }
    .sb-row + .sb-row { border-top:1px solid rgba(255,255,255,0.08); }
    .sb-player-cell {
      display:flex; align-items:center; gap:8px; padding:6px 10px;
      background:linear-gradient(90deg,rgba(255,255,255,0.06) 0%,rgba(0,0,0,0) 100%);
      font-weight:700; letter-spacing:0.6px; text-transform:uppercase;
      border-right:1px solid rgba(0,0,0,0.65);
      text-shadow:0 1px 0 rgba(0,0,0,0.6); white-space:nowrap; overflow:hidden;
      font-size:13px; color:white;
    }
    .sb-row.side-b .sb-player-cell {
      background:linear-gradient(90deg,rgba(255,255,255,0.03) 0%,rgba(0,0,0,0) 100%);
    }
    .sb-player-cell .sb-name { flex:1; overflow:hidden; text-overflow:ellipsis; color:#fefefe; }
    .sb-flag {
      width:24px; height:15px; flex-shrink:0; display:inline-flex; align-items:center; justify-content:center;
      font-size:8px; font-weight:700; border-radius:2px;
      background:#2f2f2f; color:#111; text-transform:uppercase;
      background-size:cover; background-position:center;
      box-shadow:0 0 0 1px rgba(255,255,255,0.45);
    }
    .sb-flag.has-image { color:transparent; }
    .sb-serve {
      display:inline-flex; align-items:center; justify-content:center;
      font-size:10px; line-height:1; flex-shrink:0; margin-left:auto;
      filter:drop-shadow(0 0 3px rgba(53,196,106,.6));
      animation:sb-pulse 2s ease-in-out infinite;
    }
    @keyframes sb-pulse {
      0%,100% { opacity:1; transform:scale(1); }
      50% { opacity:.7; transform:scale(.88); }
    }
    .sb-metric {
      display:flex; align-items:center; justify-content:center;
      min-height:36px; font-size:15px; font-weight:700;
      letter-spacing:0.5px; text-shadow:0 1px 0 rgba(0,0,0,0.45);
      color:white;
    }
    .sb-metric + .sb-metric { border-left:1px solid rgba(0,0,0,0.6); }
    .sb-metric.pts { background:linear-gradient(180deg,#141414 0%,#050505 100%); color:#fafafa; }
    .sb-metric.pts.is-tiebreak { background:linear-gradient(180deg,#ffe6a7 0%,#f3c34a 100%); color:#261200; text-shadow:none; }
    .sb-metric.set { background:linear-gradient(180deg,#ff7a1c 0%,#d64900 100%); color:#fff9f2; }
    .sb-metric.set.is-active { box-shadow:inset 0 0 0 2px rgba(255,255,255,0.35); }
    .sb-label-bar { text-align:center; font-weight:700; text-transform:uppercase;
      letter-spacing:0.1em; padding:4px 12px; white-space:nowrap; color:white; }

    /* stats panel inside preview */
    .sp { width:100%; background:linear-gradient(135deg,rgba(30,30,30,0.95),rgba(50,50,50,0.92));
      border-radius:12px; padding:16px 20px; box-shadow:0 4px 24px rgba(0,0,0,0.5);
      border:2px solid rgba(255,255,255,0.12); color:white; font-family:'Segoe UI',Arial,sans-serif; }
    .sp-title { text-align:center; font-size:12px; font-weight:700; text-transform:uppercase;
      letter-spacing:1.5px; margin-bottom:12px; opacity:0.7; }

    /* coords tooltip */
    .canvas-coords {
      position:absolute; bottom:8px; right:8px; background:rgba(0,0,0,0.85);
      color:#4CAF50; font-family:monospace; font-size:12px; padding:4px 12px;
      border-radius:6px; pointer-events:none; z-index:200;
    }

    /* property inputs */
    .prop-row { display:flex; align-items:center; gap:6px; margin-bottom:6px; }
    .prop-label { font-size:12px; opacity:0.7; min-width:60px; }
    .prop-input { font-size:12px; }

    /* logo crop modal */
    .crop-area { width:200px; height:200px; overflow:hidden; position:relative;
      border-radius:8px; border:2px solid rgba(255,255,255,0.2); background:#111; margin:0 auto; }
    .crop-area img { position:absolute; cursor:move; -webkit-user-select:none; -moz-user-select:none; user-select:none; }
  </style>
  <script type="module" crossorigin src="/assets/admin-Cr-amyup.js"></script>
  <link rel="modulepreload" crossorigin href="/assets/main-DtaNp4HT.js">
  <link rel="stylesheet" crossorigin href="/assets/main-BLJcpgew.css">
</head>
<body class="min-h-screen bg-base-200">
  <div x-data="adminApp" class="container mx-auto px-4 py-8 max-w-7xl">

    <header class="mb-8">
      <div class="flex justify-between items-center">
        <h1 class="text-4xl font-bold">&#9881;&#65039; Panel Administracyjny</h1>
        <div class="flex gap-2">
          <button @click="activeTab = 'courts'" :class="{'btn-primary': activeTab === 'courts'}" class="btn btn-sm">Korty</button>
          <button @click="activeTab = 'tournaments'" :class="{'btn-primary': activeTab === 'tournaments'}" class="btn btn-sm">Turnieje</button>
          <button @click="activeTab = 'players'" :class="{'btn-primary': activeTab === 'players'}" class="btn btn-sm">Gracze</button>
          <button @click="activeTab = 'settings'; initSettingsSSE(); $nextTick(() => updateCanvasScale())" :class="{'btn-primary': activeTab === 'settings'}" class="btn btn-sm">&#128250; Overlay</button>
        </div>
      </div>
    </header>

    <!-- Courts Tab -->
    <div x-show="activeTab === 'courts'" x-cloak>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Zarz&#261;dzanie kortami</h2>
          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead><tr><th>ID Kortu</th><th>PIN</th><th>Status</th><th>Akcje</th></tr></thead>
              <tbody>
                <template x-for="court in courts" :key="court.kort_id">
                  <tr>
                    <td>
                      <template x-if="editingCourt !== court.kort_id"><span class="font-bold" x-text="'Kort ' + court.kort_id"></span></template>
                      <template x-if="editingCourt === court.kort_id"><input type="text" x-model="editCourtId" class="input input-sm input-bordered w-24" @keyup.enter="saveCourt(court.kort_id)" @keyup.escape="cancelEdit()"></template>
                    </td>
                    <td><input type="text" x-model="court.pin" @change="updateCourtPin(court.kort_id, $event.target.value)" class="input input-sm input-bordered w-24" placeholder="PIN" maxlength="4" pattern="[0-9]{4}"></td>
                    <td><span class="badge" :class="court.active ? 'badge-success' : 'badge-ghost'" x-text="court.active ? 'Aktywny' : 'Nieaktywny'"></span></td>
                    <td class="flex gap-1">
                      <template x-if="editingCourt !== court.kort_id"><button @click="startEdit(court.kort_id)" class="btn btn-sm btn-ghost" title="Edytuj">&#9999;&#65039;</button></template>
                      <template x-if="editingCourt === court.kort_id"><div class="flex gap-1"><button @click="saveCourt(court.kort_id)" class="btn btn-sm btn-success">&#10003;</button><button @click="cancelEdit()" class="btn btn-sm btn-ghost">&#10007;</button></div></template>
                      <button @click="deleteCourt(court.kort_id)" class="btn btn-sm btn-ghost text-error" title="Usu&#324;">&#128465;&#65039;</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
          <div class="mt-4 flex gap-2">
            <input type="text" x-model="newCourtId" placeholder="ID nowego kortu (np. 6)" class="input input-bordered input-sm">
            <input type="text" x-model="newCourtPin" placeholder="PIN (4 cyfry)" class="input input-bordered input-sm w-32" maxlength="4" pattern="[0-9]{4}">
            <button @click="addCourt()" class="btn btn-primary btn-sm">+ Dodaj kort</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tournaments Tab -->
    <div x-show="activeTab === 'tournaments'" x-cloak>
      <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
          <h2 class="card-title">Dodaj nowy turniej</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
            <div class="form-control"><label class="label"><span class="label-text">Nazwa turnieju</span></label><input type="text" x-model="newTournament.name" class="input input-bordered" placeholder="np. IPC WIMCO 2025"></div>
            <div class="form-control"><label class="label"><span class="label-text">Data rozpocz&#281;cia</span></label><input type="date" x-model="newTournament.start_date" class="input input-bordered"></div>
            <div class="form-control"><label class="label"><span class="label-text">Data zako&#324;czenia</span></label><input type="date" x-model="newTournament.end_date" class="input input-bordered"></div>
          </div>
          <div class="card-actions justify-end mt-4"><button @click="createTournament()" class="btn btn-primary">Utw&#243;rz turniej</button></div>
        </div>
      </div>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Lista turniej&#243;w</h2>
          <div x-show="loading.tournaments" class="space-y-4"><div class="skeleton h-12 w-full"></div><div class="skeleton h-12 w-full"></div></div>
          <div x-show="!loading.tournaments" class="overflow-x-auto">
            <table class="table table-zebra">
              <thead><tr><th>Nazwa</th><th>Rozpocz&#281;cie</th><th>Zako&#324;czenie</th><th>Status</th><th>Akcje</th></tr></thead>
              <tbody>
                <template x-for="tournament in tournaments" :key="tournament.id">
                  <tr :class="{'bg-success bg-opacity-10': tournament.active}">
                    <td><span class="font-semibold" x-text="tournament.name"></span><span x-show="tournament.active" class="badge badge-success badge-sm ml-2">Aktywny</span></td>
                    <td x-text="tournament.start_date"></td>
                    <td x-text="tournament.end_date"></td>
                    <td><span x-show="!tournament.active" @click="activateTournament(tournament.id)" class="badge badge-ghost cursor-pointer hover:badge-primary">Ustaw aktywny</span></td>
                    <td class="flex gap-2">
                      <button @click="selectTournament(tournament.id)" class="btn btn-xs btn-ghost">&#128203; Gracze</button>
                      <button @click="deleteTournament(tournament.id)" class="btn btn-xs btn-error">Usu&#324;</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
          <div class="alert alert-info mt-4" x-show="tournaments.length === 0"><span>Brak turniej&#243;w. Dodaj pierwszy turniej powy&#380;ej.</span></div>
        </div>
      </div>
    </div>

    <!-- Players Tab -->
    <div x-show="activeTab === 'players'" x-cloak>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Gracze w turnieju</h2>
          <div x-show="!selectedTournament" class="alert alert-warning"><span>Wybierz turniej z zak&#322;adki "Turnieje" aby zarz&#261;dza&#263; graczami</span></div>
          <div x-show="selectedTournament">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
              <div class="form-control"><label class="label"><span class="label-text">Imi&#281; i nazwisko</span></label><input type="text" x-model="newPlayer.name" class="input input-bordered input-sm" placeholder="Jan Kowalski"></div>
              <div class="form-control"><label class="label"><span class="label-text">Kategoria</span></label><input type="text" x-model="newPlayer.category" class="input input-bordered input-sm" placeholder="B1"></div>
              <div class="form-control"><label class="label"><span class="label-text">Kraj</span></label><input type="text" x-model="newPlayer.country" class="input input-bordered input-sm" placeholder="pl" maxlength="2"></div>
              <div class="form-control"><label class="label">&nbsp;</label><button @click="addPlayer()" class="btn btn-primary btn-sm">Dodaj gracza</button></div>
            </div>
            <div class="collapse collapse-arrow bg-base-200 mb-4">
              <input type="checkbox" />
              <div class="collapse-title font-medium">&#128229; Import graczy z pliku tekstowego</div>
              <div class="collapse-content">
                <p class="text-sm mb-2">Format: <code>Imi&#281; Nazwisko Kategoria Kraj</code> (jeden gracz na lini&#281;)</p>
                <textarea x-model="importText" class="textarea textarea-bordered w-full" rows="6" placeholder="John Doe B1 us&#10;Jane Smith A1&#10;Jana Nowak B2 pl"></textarea>
                <button @click="importPlayers()" class="btn btn-primary btn-sm mt-2">Importuj graczy</button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="table table-zebra table-sm">
                <thead><tr><th>Imi&#281; i nazwisko</th><th>Kategoria</th><th>Kraj</th><th>Akcje</th></tr></thead>
                <tbody>
                  <template x-for="player in filteredPlayers" :key="player.id">
                    <tr>
                      <td x-text="player.name"></td>
                      <td><span class="badge badge-sm" x-text="player.category"></span></td>
                      <td x-text="player.country"></td>
                      <td><button @click="deletePlayer(player.id)" class="btn btn-xs btn-error">Usu&#324;</button></td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
            <div class="alert alert-info mt-4" x-show="players.length === 0 && !loading.players"><span>Brak graczy w tym turnieju</span></div>
            <div class="stats stats-vertical lg:stats-horizontal shadow mt-4">
              <div class="stat"><div class="stat-title">Liczba graczy</div><div class="stat-value" x-text="players.length"></div></div>
              <div class="stat"><div class="stat-title">Wyfiltrowani</div><div class="stat-value" x-text="filteredPlayers.length"></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ OVERLAY SETTINGS TAB ============ -->
    <div x-show="activeTab === 'settings'" x-cloak>

      <!-- Overlay preset selector toolbar -->
      <div class="flex items-center gap-3 mb-4 flex-wrap">
        <span class="font-bold text-sm opacity-70">OVERLAY:</span>
        <template x-for="(ov, oid) in (overlaySettings.overlays || {})" :key="'otab_'+oid">
          <button @click="currentOverlayId = oid; selectedElIdx = -1;"
                  :class="currentOverlayId === oid ? 'btn-primary' : 'btn-ghost'"
                  class="btn btn-sm" x-text="ov.name || oid"></button>
        </template>
        <button @click="addOverlay()" class="btn btn-sm btn-outline btn-success">+ Nowy</button>
        <button x-show="currentOverlayId && Object.keys(overlaySettings.overlays||{}).length > 1"
                @click="removeOverlay()" class="btn btn-sm btn-outline btn-error">&#128465; Usu&#324;</button>
        <div class="flex-1"></div>
        <span class="text-xs font-mono opacity-50" x-text="currentOverlayId ? (location.origin+'/overlay/'+currentOverlayId) : ''"></span>
        <button x-show="currentOverlayId" @click="copyUrl(location.origin+'/overlay/'+currentOverlayId)" class="btn btn-xs btn-ghost">&#128203;</button>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-3 gap-4" x-show="currentOverlayId">

        <!-- Left: 16:9 Canvas -->
        <div class="xl:col-span-2">
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body p-3">
              <div class="canvas-outer" x-ref="canvasOuter"
                   @pointermove="onDrag($event)" @pointerup="endDrag($event)" @pointerleave="endDrag($event)"
                   @click.self="selectedElIdx = -1">
                <div class="canvas-inner" x-ref="canvasInner" :style="'transform:scale('+canvasScale+')'">
                  <div class="canvas-grid"></div>
                  <div class="canvas-safe"></div>

                  <!-- Elements -->
                  <template x-for="(el, idx) in currentElements()" :key="'el_'+idx">
                    <div class="drag-el"
                         :class="{
                           'is-dragging': dragging?.idx === idx,
                           'is-selected': selectedElIdx === idx,
                           'el-hidden': el.visible === false
                         }"
                         :style="'left:'+el.x+'px;top:'+el.y+'px;width:'+el.w+'px;'"
                         @pointerdown.prevent="startDrag($event, idx)"
                         @click.stop="selectedElIdx = idx">
                      <!-- court scoreboard -->
                      <template x-if="el.type === 'court'">
                        <div>
                          <div x-show="el.label_text && el.label_position !== 'none' && el.label_position !== 'below'"
                               class="sb-label-bar"
                               :style="'background:rgba(0,0,0,'+(el.label_bg_opacity!=null?el.label_bg_opacity:0.7)+');font-size:'+(el.label_font_size||14)+'px;margin-bottom:'+(el.label_gap!=null?el.label_gap:4)+'px;border-radius:6px 6px 0 0;'"
                               x-text="el.label_text"></div>
                          <div x-html="renderLiveScoreboard(el)"></div>
                          <div x-show="el.label_text && el.label_position === 'below'"
                               class="sb-label-bar"
                               :style="'background:rgba(0,0,0,'+(el.label_bg_opacity!=null?el.label_bg_opacity:0.7)+');font-size:'+(el.label_font_size||14)+'px;margin-top:'+(el.label_gap!=null?el.label_gap:4)+'px;border-radius:0 0 6px 6px;'"
                               x-text="el.label_text"></div>
                        </div>
                      </template>
                      <!-- stats panel -->
                      <template x-if="el.type === 'stats'">
                        <div class="sp">
                          <div class="sp-title">Statystyki</div>
                        </div>
                      </template>
                    </div>
                  </template>
                </div>
                <!-- Coords -->
                <div class="canvas-coords" x-show="dragging" x-cloak
                     x-text="dragging ? 'x:'+currentElements()[dragging.idx]?.x+' y:'+currentElements()[dragging.idx]?.y : ''"></div>
              </div>
            </div>
          </div>

          <!-- Elements list -->
          <div class="card bg-base-100 shadow-xl mt-3">
            <div class="card-body p-3">
              <div class="flex items-center gap-2 mb-2">
                <h3 class="font-bold text-sm">Elementy</h3>
                <div class="flex-1"></div>
                <select x-model="addElCourtId" class="select select-xs select-bordered w-20">
                  <option value="1">Kort 1</option><option value="2">Kort 2</option>
                  <option value="3">Kort 3</option><option value="4">Kort 4</option>
                </select>
                <button @click="addElement('court')" class="btn btn-xs btn-success">+ Kort</button>
                <button @click="addElement('stats')" class="btn btn-xs btn-accent">+ Statystyki</button>
              </div>
              <div class="flex flex-wrap gap-1">
                <template x-for="(el, idx) in currentElements()" :key="'eli_'+idx">
                  <div class="badge cursor-pointer" @click="selectedElIdx = idx"
                       :class="selectedElIdx === idx ? 'badge-primary' : (el.visible === false ? 'badge-ghost' : 'badge-outline')"
                       x-text="el.type === 'stats' ? 'Stats (K'+el.court_id+')' : (el.label_text || 'Kort '+el.court_id)">
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Properties panel -->
        <div>
          <!-- Overlay name + auto hide -->
          <div class="card bg-base-100 shadow-xl mb-3">
            <div class="card-body p-3">
              <h3 class="font-bold text-sm mb-2">Overlay</h3>
              <div class="prop-row">
                <span class="prop-label">Nazwa</span>
                <input type="text" class="input input-xs input-bordered flex-1 prop-input"
                       :value="currentOverlay()?.name || ''"
                       @change="updateOverlayProp('name', $event.target.value)">
              </div>
              <div class="form-control">
                <label class="label cursor-pointer py-0">
                  <span class="label-text text-xs">Autoukrywanie</span>
                  <input type="checkbox" class="toggle toggle-warning toggle-xs"
                         :checked="currentOverlay()?.auto_hide"
                         @change="updateOverlayProp('auto_hide', $event.target.checked)">
                </label>
              </div>
            </div>
          </div>

          <!-- Selected element properties -->
          <div class="card bg-base-100 shadow-xl mb-3" x-show="selectedElIdx >= 0">
            <div class="card-body p-3">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-bold text-sm" x-text="selectedEl()?.type === 'stats' ? 'Statystyki' : 'Kort ' + (selectedEl()?.court_id || '')"></h3>
                <button @click="removeElement()" class="btn btn-xs btn-ghost text-error">&#128465;</button>
              </div>

              <!-- Position inputs -->
              <div class="grid grid-cols-3 gap-2 mb-2">
                <div class="prop-row"><span class="prop-label">X</span>
                  <input type="number" class="input input-xs input-bordered w-full prop-input" min="0" max="1920"
                         :value="selectedEl()?.x" @change="setElProp('x', +$event.target.value)"></div>
                <div class="prop-row"><span class="prop-label">Y</span>
                  <input type="number" class="input input-xs input-bordered w-full prop-input" min="0" max="1080"
                         :value="selectedEl()?.y" @change="setElProp('y', +$event.target.value)"></div>
                <div class="prop-row"><span class="prop-label">W</span>
                  <input type="number" class="input input-xs input-bordered w-full prop-input" min="100" max="1920"
                         :value="selectedEl()?.w" @change="setElProp('w', +$event.target.value)"></div>
              </div>

              <!-- Visibility & size (court only) -->
              <template x-if="selectedEl()?.type === 'court'">
                <div>
                  <div class="flex gap-3 mb-2 flex-wrap">
                    <label class="label cursor-pointer gap-2 py-0">
                      <span class="label-text text-xs">Widoczny</span>
                      <input type="checkbox" class="toggle toggle-primary toggle-xs"
                             :checked="selectedEl()?.visible !== false"
                             @change="setElProp('visible', $event.target.checked)">
                    </label>
                    <label class="label cursor-pointer gap-2 py-0">
                      <span class="label-text text-xs">Logo</span>
                      <input type="checkbox" class="toggle toggle-success toggle-xs"
                             :checked="selectedEl()?.show_logo"
                             @change="setElProp('show_logo', $event.target.checked)">
                    </label>
                  </div>

                  <!-- Scoreboard options -->
                  <div class="divider my-1 text-xs opacity-50">Scoreboard</div>

                  <!-- Scoreboard bg opacity -->
                  <div class="prop-row">
                    <span class="prop-label">T&#322;o SB</span>
                    <input type="range" class="range range-xs range-info flex-1" min="0" max="100" step="5"
                           :value="Math.round((selectedEl()?.bg_opacity != null ? selectedEl().bg_opacity : 0.95) * 100)"
                           @input="setElProp('bg_opacity', +$event.target.value / 100)">
                    <span class="text-xs opacity-50 w-10 text-right" x-text="Math.round((selectedEl()?.bg_opacity != null ? selectedEl().bg_opacity : 0.95) * 100) + '%'"></span>
                  </div>

                  <!-- Logo size (only when logo enabled) -->
                  <div class="prop-row" x-show="selectedEl()?.show_logo">
                    <span class="prop-label">Logo px</span>
                    <input type="range" class="range range-xs range-success flex-1" min="20" max="200" step="5"
                           :value="selectedEl()?.logo_size || 60"
                           @input="setElProp('logo_size', +$event.target.value)">
                    <span class="text-xs opacity-50 w-10 text-right" x-text="(selectedEl()?.logo_size || 60) + 'px'"></span>
                  </div>

                  <!-- Label settings -->
                  <div class="divider my-1 text-xs opacity-50">Napis kortu</div>
                  <div class="prop-row">
                    <span class="prop-label">Tekst</span>
                    <input type="text" class="input input-xs input-bordered flex-1 prop-input"
                           :value="selectedEl()?.label_text || ''"
                           @change="setElProp('label_text', $event.target.value)">
                  </div>
                  <div class="flex gap-2 mb-1">
                    <div class="prop-row flex-1">
                      <span class="prop-label">Pozycja</span>
                      <select class="select select-xs select-bordered flex-1"
                              :value="selectedEl()?.label_position || 'above'"
                              @change="setElProp('label_position', $event.target.value)">
                        <option value="above">Nad</option>
                        <option value="below">Pod</option>
                        <option value="none">Brak</option>
                      </select>
                    </div>
                    <div class="prop-row flex-1">
                      <span class="prop-label">Odst&#281;p</span>
                      <input type="number" class="input input-xs input-bordered w-16 prop-input" min="0" max="40"
                             :value="selectedEl()?.label_gap || 4"
                             @change="setElProp('label_gap', +$event.target.value)">
                    </div>
                  </div>
                  <div class="flex gap-2">
                    <div class="prop-row flex-1">
                      <span class="prop-label">Rozmiar</span>
                      <input type="number" class="input input-xs input-bordered w-16 prop-input" min="8" max="30"
                             :value="selectedEl()?.label_font_size || 13"
                             @change="setElProp('label_font_size', +$event.target.value)">
                    </div>
                    <div class="prop-row flex-1">
                      <span class="prop-label">T&#322;o</span>
                      <input type="range" class="range range-xs range-primary flex-1" min="0" max="100" step="5"
                             :value="Math.round((selectedEl()?.label_bg_opacity || 0.7) * 100)"
                             @input="setElProp('label_bg_opacity', +$event.target.value / 100)">
                      <span class="text-xs opacity-50 w-8" x-text="Math.round((selectedEl()?.label_bg_opacity || 0.7) * 100) + '%'"></span>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Stats: court selector + visibility -->
              <template x-if="selectedEl()?.type === 'stats'">
                <div>
                  <div class="flex gap-3">
                    <label class="label cursor-pointer gap-2 py-0">
                      <span class="label-text text-xs">Widoczny</span>
                      <input type="checkbox" class="toggle toggle-accent toggle-xs"
                             :checked="selectedEl()?.visible !== false"
                             @change="setElProp('visible', $event.target.checked)">
                    </label>
                    <div class="prop-row flex-1">
                      <span class="prop-label">Kort</span>
                      <select class="select select-xs select-bordered flex-1"
                              :value="selectedEl()?.court_id || '1'"
                              @change="setElProp('court_id', $event.target.value)">
                        <option value="1">Kort 1</option><option value="2">Kort 2</option>
                        <option value="3">Kort 3</option><option value="4">Kort 4</option>
                      </select>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- Tournament branding -->
          <div class="card bg-base-100 shadow-xl mb-3">
            <div class="card-body p-3">
              <h3 class="font-bold text-sm mb-2">Logo turnieju</h3>
              <div class="flex items-center gap-3 mb-2">
                <div x-show="overlaySettings.tournament_logo" class="w-16 h-16 rounded-lg overflow-hidden bg-base-300 flex-shrink-0">
                  <img :src="overlaySettings.tournament_logo" class="w-full h-full object-cover">
                </div>
                <div x-show="!overlaySettings.tournament_logo" class="w-16 h-16 rounded-lg bg-base-300 flex items-center justify-center text-2xl flex-shrink-0">&#127934;</div>
                <div class="flex-1">
                  <input type="file" accept="image/*" @change="onLogoFileSelect($event)" class="file-input file-input-xs file-input-bordered w-full">
                  <button x-show="overlaySettings.tournament_logo" @click="removeLogo()" class="btn btn-xs btn-ghost text-error mt-1">Usu&#324; logo</button>
                </div>
              </div>
              <div class="prop-row">
                <span class="prop-label">Nazwa</span>
                <input type="text" class="input input-xs input-bordered flex-1 prop-input"
                       :value="overlaySettings.tournament_name || ''"
                       @change="overlaySettings.tournament_name = $event.target.value; saveOverlaySettings()">
              </div>
            </div>
          </div>

          <!-- All overlay URLs -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body p-3">
              <h3 class="font-bold text-sm mb-2">URL do OBS</h3>
              <div class="space-y-1">
                <template x-for="(ov, oid) in (overlaySettings.overlays || {})" :key="'url_'+oid">
                  <div class="flex items-center gap-1">
                    <span class="text-xs font-mono opacity-60 truncate flex-1" x-text="location.origin + '/overlay/' + oid"></span>
                    <button @click="copyUrl(location.origin+'/overlay/'+oid)" class="btn btn-xs btn-ghost">&#128203;</button>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Logo crop modal -->
    <dialog x-ref="cropModal" class="modal">
      <div class="modal-box">
        <h3 class="font-bold text-lg mb-4">Przytnij logo (kwadrat)</h3>
        <div class="crop-area" x-ref="cropArea">
          <img x-ref="cropImg" :src="cropImgSrc" draggable="false"
               @pointerdown.prevent="startCropDrag($event)"
               @pointermove="onCropDrag($event)"
               @pointerup="endCropDrag()" @pointerleave="endCropDrag()">
        </div>
        <div class="flex items-center gap-2 mt-3">
          <span class="text-xs opacity-60">Zoom</span>
          <input type="range" class="range range-sm flex-1" min="100" max="400" step="10"
                 x-model.number="cropZoom" @input="updateCropTransform()">
        </div>
        <div class="modal-action">
          <button @click="applyCrop()" class="btn btn-primary btn-sm">Zapisz</button>
          <button @click="$refs.cropModal.close()" class="btn btn-sm">Anuluj</button>
        </div>
      </div>
    </dialog>

  </div>

  <!-- Toast -->
  <div class="toast toast-end" x-data x-show="$store.toast?.show" x-cloak>
    <div class="alert" :class="'alert-' + ($store.toast?.type || 'info')">
      <span x-text="$store.toast?.message"></span>
    </div>
  </div>

</body>
</html>