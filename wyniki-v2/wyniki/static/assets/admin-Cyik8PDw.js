import{m as l}from"./main-DtaNp4HT.js";window.Alpine=l;l.data("adminApp",()=>({activeTab:"courts",courts:[],newCourtId:"",newCourtPin:"",editingCourt:null,editCourtId:"",tournaments:[],selectedTournament:null,newTournament:{name:"",start_date:"",end_date:""},players:[],newPlayer:{name:"",category:"",country:""},importText:"",overlaySettings:{courts_visible:{1:!0,2:!0,3:!0,4:!0},auto_hide:!1,show_stats:!1,court_positions:{1:{x:24,y:896,w:420,size:"large"},2:{x:20,y:20,w:260,size:"small"},3:{x:292,y:20,w:260,size:"small"},4:{x:564,y:20,w:260,size:"small"}},stats_position:{x:460,y:836,w:360}},dragging:null,loading:{courts:!1,tournaments:!1,players:!1},toast:{show:!1,message:"",type:"info"},get filteredPlayers(){return this.players},init(){this.loadCourts(),this.loadTournaments(),this.loadOverlaySettings()},showToast(t,s="info"){this.toast={show:!0,message:t,type:s},setTimeout(()=>{this.toast.show=!1},3e3)},async loadCourts(){this.loading.courts=!0;try{const t=await fetch("/admin/api/courts");if(!t.ok)throw new Error("Failed to load courts");this.courts=await t.json()}catch(t){console.error("Failed to load courts:",t),this.showToast("Błąd ładowania kortów","error")}finally{this.loading.courts=!1}},async refreshCourts(){await this.loadCourts(),this.showToast("Korty odświeżone","success")},async updateCourtPin(t,s){try{if(s&&(s.length!==4||!/^\d{4}$/.test(s))){this.showToast("PIN musi mieć 4 cyfry","warning"),await this.loadCourts();return}if(!(await fetch(`/admin/api/courts/${t}/pin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({pin:s||null})})).ok)throw new Error("Failed to update PIN");this.showToast(`PIN dla kortu ${t} zaktualizowany`,"success"),await this.loadCourts()}catch(e){console.error("Failed to update PIN:",e),this.showToast("Błąd aktualizacji PIN","error")}},async addCourt(){if(!this.newCourtId){this.showToast("Wprowadź ID kortu","warning");return}if(this.newCourtPin&&(this.newCourtPin.length!==4||!/^\d{4}$/.test(this.newCourtPin))){this.showToast("PIN musi mieć 4 cyfry","warning");return}try{if(!(await fetch("/admin/api/courts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kort_id:this.newCourtId,pin:this.newCourtPin||null})})).ok)throw new Error("Failed to add court");this.showToast(`Kort ${this.newCourtId} dodany`,"success"),this.newCourtId="",this.newCourtPin="",await this.loadCourts()}catch(t){console.error("Failed to add court:",t),this.showToast("Błąd dodawania kortu","error")}},startEdit(t){this.editingCourt=t,this.editCourtId=t},cancelEdit(){this.editingCourt=null,this.editCourtId=""},async saveCourt(t){if(!this.editCourtId){this.showToast("ID kortu nie może być puste","warning");return}if(this.editCourtId===t){this.cancelEdit();return}try{const s=await fetch(`/admin/api/courts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({kort_id:this.editCourtId})});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to rename court")}this.showToast(`Kort ${t} zmieniono na ${this.editCourtId}`,"success"),this.cancelEdit(),await this.loadCourts()}catch(s){console.error("Failed to rename court:",s),this.showToast(s.message||"Błąd zmiany nazwy kortu","error")}},async deleteCourt(t){if(confirm(`Czy na pewno chcesz usunąć Kort ${t}?`))try{if(!(await fetch(`/admin/api/courts/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete court");this.showToast(`Kort ${t} usunięty`,"success"),await this.loadCourts()}catch(s){console.error("Failed to delete court:",s),this.showToast("Błąd usuwania kortu","error")}},async loadTournaments(){this.loading.tournaments=!0;try{const t=await fetch("/admin/api/tournaments");if(!t.ok)throw new Error("Failed to load tournaments");if(this.tournaments=await t.json(),!this.selectedTournament){const s=this.tournaments.find(e=>e.active);s&&(this.selectedTournament=s.id,await this.loadPlayers(s.id))}}catch(t){console.error("Failed to load tournaments:",t),this.showToast("Błąd ładowania turniejów","error")}finally{this.loading.tournaments=!1}},async createTournament(){if(!this.newTournament.name||!this.newTournament.start_date||!this.newTournament.end_date){this.showToast("Wypełnij wszystkie pola","warning");return}try{if(!(await fetch("/admin/api/tournaments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newTournament)})).ok)throw new Error("Failed to create tournament");this.showToast("Turniej utworzony","success"),this.newTournament={name:"",start_date:"",end_date:""},await this.loadTournaments()}catch(t){console.error("Failed to create tournament:",t),this.showToast("Błąd tworzenia turnieju","error")}},async deleteTournament(t){if(confirm("Czy na pewno usunąć ten turniej?"))try{if(!(await fetch(`/admin/api/tournaments/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete tournament");this.showToast("Turniej usunięty","success"),await this.loadTournaments()}catch(s){console.error("Failed to delete tournament:",s),this.showToast("Błąd usuwania turnieju","error")}},async activateTournament(t){try{if(!(await fetch(`/admin/api/tournaments/${t}/activate`,{method:"POST"})).ok)throw new Error("Failed to activate tournament");this.showToast("Turniej aktywowany","success"),await this.loadTournaments()}catch(s){console.error("Failed to activate tournament:",s),this.showToast("Błąd aktywacji turnieju","error")}},async selectTournament(t){this.selectedTournament=t,this.activeTab="players",await this.loadPlayers(t)},async loadPlayers(t){if(t){this.loading.players=!0;try{const s=await fetch(`/admin/api/tournaments/${t}/players`);if(!s.ok)throw new Error("Failed to load players");this.players=await s.json()}catch(s){console.error("Failed to load players:",s),this.showToast("Błąd ładowania graczy","error")}finally{this.loading.players=!1}}},async addPlayer(){if(!this.selectedTournament||!this.newPlayer.name){this.showToast("Wprowadź imię i nazwisko gracza","warning");return}try{if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newPlayer)})).ok)throw new Error("Failed to add player");this.showToast("Gracz dodany","success"),this.newPlayer={name:"",category:"",country:""},await this.loadPlayers(this.selectedTournament)}catch(t){console.error("Failed to add player:",t),this.showToast("Błąd dodawania gracza","error")}},async deletePlayer(t){if(confirm("Czy na pewno usunąć tego gracza?"))try{if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete player");this.showToast("Gracz usunięty","success"),await this.loadPlayers(this.selectedTournament)}catch(s){console.error("Failed to delete player:",s),this.showToast("Błąd usuwania gracza","error")}},async importPlayers(){if(!this.selectedTournament||!this.importText.trim()){this.showToast("Wprowadź dane graczy","warning");return}try{const s=this.importText.trim().split(`
`).filter(o=>o.trim()).map(o=>{const i=o.trim().split(/\s+/),r=i.slice(0,-2).join(" ")||i.join(" "),a=i[i.length-2]||"",n=i[i.length-1]||"";return{name:r,category:a,country:n}});if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players/bulk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({players:s})})).ok)throw new Error("Failed to import players");this.showToast(`Zaimportowano ${s.length} graczy`,"success"),this.importText="",await this.loadPlayers(this.selectedTournament)}catch(t){console.error("Failed to import players:",t),this.showToast("Błąd importu graczy","error")}},async loadOverlaySettings(){try{const t=await fetch("/api/overlay/settings");if(t.ok){const s=await t.json();this.overlaySettings=s}}catch(t){console.error("Failed to load overlay settings:",t)}this.overlaySettings.court_positions||(this.overlaySettings.court_positions={1:{x:24,y:896,w:420,size:"large"},2:{x:20,y:20,w:260,size:"small"},3:{x:292,y:20,w:260,size:"small"},4:{x:564,y:20,w:260,size:"small"}}),this.overlaySettings.stats_position||(this.overlaySettings.stats_position={x:460,y:836,w:360})},async saveOverlaySettings(){try{const t=await fetch("/api/overlay/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.overlaySettings)});if(!t.ok)throw new Error("Failed to save settings");this.overlaySettings=await t.json()}catch(t){console.error("Failed to save overlay settings:",t),this.showToast("Błąd zapisu ustawień overlay","error")}},async toggleCourt(t){this.overlaySettings.courts_visible[t]=!this.overlaySettings.courts_visible[t],await this.saveOverlaySettings();const s=this.overlaySettings.courts_visible[t]?"widoczny":"ukryty";this.showToast(`Kort ${t}: ${s}`,"success")},async toggleAutoHide(){this.overlaySettings.auto_hide=!this.overlaySettings.auto_hide,await this.saveOverlaySettings(),this.showToast(this.overlaySettings.auto_hide?"Autoukrywanie włączone":"Autoukrywanie wyłączone","success")},async toggleShowStats(){this.overlaySettings.show_stats=!this.overlaySettings.show_stats,await this.saveOverlaySettings(),this.showToast(this.overlaySettings.show_stats?"Statystyki włączone":"Statystyki wyłączone","success")},getPreviewStyle(t){let s,e,o;return t==="stats"?(s=this.overlaySettings.stats_position||{x:460,y:836,w:360},e=s.w||360,o=220):(s=(this.overlaySettings.court_positions||{})[t]||{x:20,y:20,w:260,size:"small"},e=s.w||(s.size==="large"?420:260),o=s.size==="large"?160:100),`left:${s.x/1920*100}%;top:${s.y/1080*100}%;width:${e/1920*100}%;height:${o/1080*100}%;`},startDrag(t,s){const e=this.$refs.preview;if(!e)return;const o=e.getBoundingClientRect(),i=1920/o.width,r=1080/o.height;let a;s==="stats"?a=this.overlaySettings.stats_position||{x:460,y:836,w:360}:a=(this.overlaySettings.court_positions||{})[s]||{x:20,y:20,w:260,size:"small"};const n=a.w||(s==="stats"?360:a.size==="large"?420:260),h=s==="stats"?220:a.size==="large"?160:100,c=a.x/i,d=a.y/r;this.dragging={id:s,offsetX:t.clientX-o.left-c,offsetY:t.clientY-o.top-d,w:n,h},t.target.setPointerCapture(t.pointerId)},onDrag(t){if(!this.dragging)return;const s=this.$refs.preview;if(!s)return;const e=s.getBoundingClientRect(),o=1920/e.width,i=1080/e.height;let r=(t.clientX-e.left-this.dragging.offsetX)*o,a=(t.clientY-e.top-this.dragging.offsetY)*i;r=Math.max(0,Math.min(1920-this.dragging.w,Math.round(r))),a=Math.max(0,Math.min(1080-this.dragging.h,Math.round(a))),this.dragging.id==="stats"?(this.overlaySettings.stats_position.x=r,this.overlaySettings.stats_position.y=a):(this.overlaySettings.court_positions[this.dragging.id].x=r,this.overlaySettings.court_positions[this.dragging.id].y=a)},async endDrag(t){this.dragging&&(this.dragging=null,await this.saveOverlaySettings(),this.showToast("Pozycja zapisana","success"))},getDragPos(){if(!this.dragging)return{x:0,y:0};if(this.dragging.id==="stats"){const s=this.overlaySettings.stats_position;return{x:s.x,y:s.y}}const t=this.overlaySettings.court_positions[this.dragging.id];return{x:t.x,y:t.y}},async setCourtSize(t,s){const e=this.overlaySettings.court_positions;!e||!e[t]||(e[t].size=s,e[t].w=s==="large"?420:260,await this.saveOverlaySettings(),this.showToast(`Kort ${t}: ${s==="large"?"Duży":"Mały"}`,"success"))},async resetPositions(){this.overlaySettings.court_positions={1:{x:24,y:896,w:420,size:"large"},2:{x:20,y:20,w:260,size:"small"},3:{x:292,y:20,w:260,size:"small"},4:{x:564,y:20,w:260,size:"small"}},this.overlaySettings.stats_position={x:460,y:836,w:360},await this.saveOverlaySettings(),this.showToast("Układ zresetowany do domyślnego","success")},getOverlayUrl(t){const s=window.location.origin;return t==="all"?`${s}/overlay/all`:`${s}/overlay/${t}`},async copyUrl(t){try{await navigator.clipboard.writeText(t),this.showToast("URL skopiowany do schowka","success")}catch{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.showToast("URL skopiowany","success")}}}));l.start();
