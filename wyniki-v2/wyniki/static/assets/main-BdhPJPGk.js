import{m as b}from"./main-CbaNQPvU.js";function w(e){return!e||e.length<2?"":"https://flagcdn.com/w40/"+e.toLowerCase().slice(0,2)+".png"}const k={pl:{htmlLang:"pl",pageTitle:"Wyniki tenisowe – na żywo",navLabel:"Szybka nawigacja po kortach",courtLabel:"Kort {court}",liveBadge:"LIVE",versus:"vs",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Punkty",tieBreak:"Tie Break",superTieBreak:"Super TB",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Gracz A",defaultB:"Gracz B"},meta:{lastRefresh:"Ostatnie odświeżenie: {time}."},accessibility:{versus:"kontra",points:"punkty",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"aktywny",serving:"serwuje"},history:{title:"Historia meczów",court:"Kort",vs:"vs",score:"wynik",time:"czas",category:"Kategoria"},footer:{set:"Set"},stats:{aces:"Asy",doubleFaults:"Podwójne błędy",winners:"Winnery",forcedErrors:"Wymuszone błędy",unforcedErrors:"Niewymuszone błędy",firstServe:"1. serwis",firstServePct:"1. serwis %",pointsWon:"Pkt wygrane",advanced:"Statystyki zaawansowane",simple:"Statystyki podstawowe"},emptyTitle:"Brak aktywnych kortów",emptyText:"Skonfiguruj korty w panelu administratora",loading:"Ładowanie wyników...",historyDetail:{details:"Szczegóły",collapse:"Zwiń",loading:"Ładowanie...",noStats:"Brak statystyk",category:"Kategoria",duration:"Czas"}},de:{htmlLang:"de",pageTitle:"Tennis-Ergebnisse – live",navLabel:"Schnellnavigation zu den Plätzen",courtLabel:"Platz {court}",liveBadge:"LIVE",versus:"gegen",tieBreakLabel:"TIEBREAK",superTieBreakLabel:"SUPER-TIEBREAK",table:{columns:{points:"Punkte",tieBreak:"Tiebreak",superTieBreak:"Super-Tiebreak",set1:"Satz 1",set2:"Satz 2",set3:"Satz 3"}},players:{defaultA:"Spieler A",defaultB:"Spieler B"},meta:{lastRefresh:"Letzte Aktualisierung: {time}."},accessibility:{versus:"gegen",points:"Punkte",tieBreak:"Tiebreak",superTieBreak:"Super-Tiebreak",set:"Satz {number}",active:"aktiv",serving:"Aufschlag"},history:{title:"Match-Historie",court:"Platz",vs:"gegen",score:"Ergebnis",time:"Zeit",category:"Kategorie"},footer:{set:"Satz"},stats:{aces:"Asse",doubleFaults:"Doppelfehler",winners:"Winner",forcedErrors:"Erzwungene Fehler",unforcedErrors:"Unerzwungene Fehler",firstServe:"1. Aufschlag",firstServePct:"1. Aufschlag %",pointsWon:"Gew. Punkte",advanced:"Erweiterte Statistiken",simple:"Einfache Statistiken"},emptyTitle:"Keine aktiven Plätze",emptyText:"Plätze im Adminbereich konfigurieren",loading:"Ergebnisse werden geladen...",historyDetail:{details:"Details",collapse:"Einklappen",loading:"Laden...",noStats:"Keine Statistiken",category:"Kategorie",duration:"Dauer"}},en:{htmlLang:"en",pageTitle:"Tennis Scores – Live",navLabel:"Quick court navigation",courtLabel:"Court {court}",liveBadge:"LIVE",versus:"vs",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Points",tieBreak:"Tie-break",superTieBreak:"Super tie-break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Player A",defaultB:"Player B"},meta:{lastRefresh:"Last refresh: {time}."},accessibility:{versus:"versus",points:"points",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"active",serving:"serving"},history:{title:"Match history",court:"Court",vs:"vs",score:"score",time:"time",category:"Category"},footer:{set:"Set"},stats:{aces:"Aces",doubleFaults:"Double faults",winners:"Winners",forcedErrors:"Forced errors",unforcedErrors:"Unforced errors",firstServe:"1st serve",firstServePct:"1st serve %",pointsWon:"Points won",advanced:"Advanced statistics",simple:"Basic statistics"},emptyTitle:"No active courts",emptyText:"Configure courts in the admin panel",loading:"Loading scores...",historyDetail:{details:"Details",collapse:"Collapse",loading:"Loading...",noStats:"No statistics",category:"Category",duration:"Duration"}},it:{htmlLang:"it",pageTitle:"Risultati tennis – in diretta",navLabel:"Navigazione rapida dei campi",courtLabel:"Campo {court}",liveBadge:"LIVE",versus:"contro",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Punti",tieBreak:"Tie-break",superTieBreak:"Super tie-break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Giocatore A",defaultB:"Giocatore B"},meta:{lastRefresh:"Ultimo aggiornamento: {time}."},accessibility:{versus:"contro",points:"punti",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"attivo",serving:"al servizio"},history:{title:"Storico incontri",court:"Campo",vs:"contro",score:"risultato",time:"tempo",category:"Categoria"},footer:{set:"Set"},stats:{aces:"Ace",doubleFaults:"Doppi falli",winners:"Vincenti",forcedErrors:"Errori forzati",unforcedErrors:"Errori non forzati",firstServe:"1° servizio",firstServePct:"1° servizio %",pointsWon:"Punti vinti",advanced:"Statistiche avanzate",simple:"Statistiche base"},emptyTitle:"Nessun campo attivo",emptyText:"Configura i campi nel pannello di amministrazione",loading:"Caricamento risultati...",historyDetail:{details:"Dettagli",collapse:"Chiudi",loading:"Caricamento...",noStats:"Nessuna statistica",category:"Categoria",duration:"Durata"}},es:{htmlLang:"es",pageTitle:"Resultados de tenis – en vivo",navLabel:"Navegación rápida por canchas",courtLabel:"Cancha {court}",liveBadge:"EN VIVO",versus:"contra",tieBreakLabel:"TIE BREAK",superTieBreakLabel:"SUPER TIE BREAK",table:{columns:{points:"Puntos",tieBreak:"Tie break",superTieBreak:"Súper tie break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Jugador A",defaultB:"Jugador B"},meta:{lastRefresh:"Última actualización: {time}."},accessibility:{versus:"contra",points:"puntos",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"activo",serving:"al servicio"},history:{title:"Historial de partidos",court:"Cancha",vs:"contra",score:"resultado",time:"tiempo",category:"Categoría"},footer:{set:"Set"},stats:{aces:"Aces",doubleFaults:"Dobles faltas",winners:"Ganadores",forcedErrors:"Errores forzados",unforcedErrors:"Errores no forzados",firstServe:"1er servicio",firstServePct:"1er servicio %",pointsWon:"Puntos ganados",advanced:"Estadísticas avanzadas",simple:"Estadísticas básicas"},emptyTitle:"No hay canchas activas",emptyText:"Configure las canchas en el panel de administración",loading:"Cargando resultados...",historyDetail:{details:"Detalles",collapse:"Cerrar",loading:"Cargando...",noStats:"Sin estadísticas",category:"Categoría",duration:"Duración"}},fr:{htmlLang:"fr",pageTitle:"Résultats tennis – en direct",navLabel:"Navigation rapide des courts",courtLabel:"Court {court}",liveBadge:"EN DIRECT",versus:"contre",tieBreakLabel:"JEU DÉCISIF",superTieBreakLabel:"SUPER JEU DÉCISIF",table:{columns:{points:"Points",tieBreak:"Jeu décisif",superTieBreak:"Super jeu décisif",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Joueur A",defaultB:"Joueur B"},meta:{lastRefresh:"Dernière mise à jour: {time}."},accessibility:{versus:"contre",points:"points",tieBreak:"jeu décisif",superTieBreak:"super jeu décisif",set:"Set {number}",active:"actif",serving:"au service"},history:{title:"Historique des matchs",court:"Court",vs:"contre",score:"score",time:"temps",category:"Catégorie"},footer:{set:"Set"},stats:{aces:"Aces",doubleFaults:"Doubles fautes",winners:"Coups gagnants",forcedErrors:"Fautes provoquées",unforcedErrors:"Fautes directes",firstServe:"1er service",firstServePct:"1er service %",pointsWon:"Points gagnés",advanced:"Statistiques avancées",simple:"Statistiques de base"},emptyTitle:"Aucun court actif",emptyText:"Configurez les courts dans le panneau d'administration",loading:"Chargement des résultats...",historyDetail:{details:"Détails",collapse:"Réduire",loading:"Chargement...",noStats:"Pas de statistiques",category:"Catégorie",duration:"Durée"}}};function L(e){return k[e]||k.pl}function f(e,t={}){return e.replace(/\{(\w+)\}/g,(s,r)=>t[r]??`{${r}}`)}function S(e){e&&(e.classList.add("changed"),setTimeout(()=>e.classList.remove("changed"),1200))}function $(e,t,s){try{const r=String(t??""),a=String(s??""),i=Math.max(r.length,a.length),n=document.createElement("span");n.className="digits";for(let o=0;o<i;o++){const c=document.createElement("span");c.className="digit";const u=document.createElement("span");u.className="d-old",u.textContent=r[o]??"";const l=document.createElement("span");l.className="d-new",l.textContent=a[o]??"",c.append(u,l),n.appendChild(c)}e.innerHTML="",e.appendChild(n),e.classList.add("rolling"),setTimeout(()=>{e.classList.remove("rolling"),e.textContent=s},350)}catch{e.textContent=s}}function B(e){if(!e||typeof e!="object")return!1;const t=parseInt(e.A??e.a??0,10),s=parseInt(e.B??e.b??0,10);return(isNaN(t)?0:t)!==0||(isNaN(s)?0:s)!==0}window.Alpine=b;b.data("tennisApp",()=>({courts:{},prevCourts:{},loading:!0,error:null,lastUpdate:null,lang:"pl",darkMode:!1,history:[],expandedMatchStats:{},init(){const e=localStorage.getItem("theme");(e==="dark"||!e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&(this.darkMode=!0,document.documentElement.setAttribute("data-theme","dark")),this.connectSSE(),this.fetchInitialData(),this.fetchHistory()},codeToFlag(e){return w(e)},tr(){return L(this.lang)},acc(){return this.tr().accessibility||{}},t(e,t={}){const s=this.tr(),r=e.split(".").reduce((a,i)=>a==null?void 0:a[i],s);return typeof r=="string"?f(r,t):e==="setLabel"?f(this.acc().set||"Set {number}",t):e==="courtLabel"?f(s.courtLabel||"Kort {court}",t):e==="navLabel"?s.navLabel||"Nawigacja":""},onLangChange(){document.documentElement.lang=this.tr().htmlLang||this.lang,document.title=this.tr().pageTitle||"Wyniki tenisowe – na żywo"},toggleDarkMode(){this.darkMode=!this.darkMode;const e=this.darkMode?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},async fetchInitialData(){try{const e=await fetch("/api/snapshot");if(!e.ok)throw new Error("Failed to fetch courts");const t=await e.json();this.courts=t.courts||{},this.loading=!1,this.lastUpdate=new Date}catch(e){this.error=e.message,this.loading=!1}},async fetchHistory(){try{const e=await fetch("/api/history");if(!e.ok)return;const t=await e.json();this.history=Array.isArray(t)?t:[]}catch{}},connectSSE(){const e=new EventSource("/api/stream");e.addEventListener("court_update",t=>{var s,r;try{const a=JSON.parse(t.data),i=String(a.court_id),n=this.courts[i];this.$nextTick(()=>{this.animateChanges(i,n,a)}),this.prevCourts[i]=n?{...n}:{},this.courts[i]=a,this.lastUpdate=new Date,(s=n==null?void 0:n.match_status)!=null&&s.active&&!((r=a==null?void 0:a.match_status)!=null&&r.active)&&this.fetchHistory()}catch{}}),e.onerror=()=>{this.error="Połączenie przerwane",setTimeout(()=>this.connectSSE(),5e3)}},animateChanges(e,t,s){if(!t)return;const r=["A","B"];r.forEach(a=>{const i=this.resolveDisplayPoints(t,a),n=this.resolveDisplayPoints(s,a);if(i!==n){const o=document.getElementById(`k${e}-pts-${a}`);o&&($(o,i,n),S(o),(n==="ADV"||n==="40")&&(o.classList.add("flip-strong"),setTimeout(()=>o.classList.remove("flip-strong"),450)))}});for(let a=1;a<=3;a++)r.forEach(i=>{var u,l;const n=`set${a}`,o=(u=t[i])==null?void 0:u[n],c=(l=s[i])==null?void 0:l[n];if(c!==void 0&&c!==o){const p=document.getElementById(`k${e}-s${a}-${i}`);p&&S(p)}});r.forEach(a=>{var o,c,u,l;const i=((o=t[a])==null?void 0:o.full_name)||((c=t[a])==null?void 0:c.surname),n=((u=s[a])==null?void 0:u.full_name)||((l=s[a])==null?void 0:l.surname);if(n&&i!==n){const p=document.getElementById(`k${e}-name-${a}`);p&&S(p)}})},resolveDisplayPoints(e,t){var i;if(!e)return"0";const s=e.tie||{};if(B(s)){const n=s[t]??s[t.toLowerCase()];return n!=null?String(n):"0"}const a=(i=e[t])==null?void 0:i.points;return a!=null?String(a):"0"},getCourtIds(){return Object.keys(this.courts).map(e=>parseInt(e)).filter(e=>!isNaN(e)&&e>0).sort((e,t)=>e-t).map(e=>e.toString())},hasActiveCourts(){return Object.values(this.courts).some(e=>{var t;return(t=e.match_status)==null?void 0:t.active})},isMatchActive(e){var t,s;return((s=(t=this.courts[e])==null?void 0:t.match_status)==null?void 0:s.active)||!1},getPlayerName(e,t){var a;const s=(a=this.courts[e])==null?void 0:a[t];if(s){const i=s.full_name;if(i&&String(i).trim())return String(i).trim();const n=s.surname;if(n&&n!=="-")return n}const r=this.tr();return t==="A"?r.players.defaultA:r.players.defaultB},getHeadingAria(e){var u;const t=this.t("courtLabel",{court:e}),s=this.getPlayerName(e,"A"),r=this.getPlayerName(e,"B"),a=this.acc().versus||"kontra",i=(u=this.courts[e])==null?void 0:u.serve,n=this.acc().serving||"serwuje",o=i==="A"?`${s} (${n})`:s,c=i==="B"?`${r} (${n})`:r;return`${t}: ${o} ${a} ${c}`},isTiebreak(e){var s;const t=(s=this.courts[e])==null?void 0:s.tie;return B(t)},isSuperTiebreak(e){const t=this.courts[e];return t?this.isTiebreak(e)&&(t.current_set===3||t.current_set==="3"):!1},getDisplayPoints(e,t){return this.resolveDisplayPoints(this.courts[e],t)},getPointsLabel(e){var r;const s=((r=this.tr().table)==null?void 0:r.columns)||{};return this.isSuperTiebreak(e)?s.superTieBreak||"Super TB":this.isTiebreak(e)?s.tieBreak||"Tie Break":s.points||"Punkty"},getSetIndices(e){var a,i;const t=this.courts[e];if(!t)return[1,2];const s=parseInt(t.current_set)||1,r=[1,2];return(s>=3||(a=t.A)!=null&&a.set3||(i=t.B)!=null&&i.set3)&&r.push(3),r},getSetScore(e,t,s){var n,o;const r=this.courts[e];if(!r)return"0";const a=parseInt(r.current_set)||1;if(s===a){const c=(n=r[t])==null?void 0:n.current_games;if(c!=null)return String(c)}const i=(o=r[t])==null?void 0:o[`set${s}`];return i!=null?String(i):"0"},getScoreSummary(e){const t=this.courts[e];if(!t)return"";const s=this.acc(),r=this.isTiebreak(e),a=this.isSuperTiebreak(e),i=parseInt(t.current_set)||1,n=t.serve,o=s.serving||"serwuje",c=n==="A"?`${this.getPlayerName(e,"A")} ${o}`:n==="B"?`${this.getPlayerName(e,"B")} ${o}`:null,u=r?a?s.superTieBreak||"super tie-break":s.tieBreak||"tie-break":s.points||"punkty",l=this.getDisplayPoints(e,"A"),p=this.getDisplayPoints(e,"B"),h=[];return c&&h.push(c),h.push(`${u} ${l}:${p}`),this.getSetIndices(e).forEach(d=>{const m=this.getSetScore(e,"A",d),v=this.getSetScore(e,"B",d),T=parseInt(m)||0,E=parseInt(v)||0;if(!(d===1||i>=d||T>0||E>0))return;const y=f(s.set||"Set {number}",{number:d}),A=i===d?`${y}, ${s.active||"aktywny"}, ${m}:${v}`:`${y} ${m}:${v}`;h.push(A)}),h.join(". ").trim()},getScore(e,t){const s=this.courts[e];if(!s)return{sets:[],points:"-"};const r=s[t];return r?{sets:r.sets||[],points:r.points||"0"}:{sets:[],points:"-"}},formatTime(e){if(!e)return"";const t=Math.floor(e/3600),s=Math.floor(e%3600/60);return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},formatHistoryScore(e,t,s){if(!e||!t)return"–";const r=[],a=Math.max(e.length,t.length);for(let i=0;i<a;i++){const n=e[i]??0,o=t[i]??0;if(n===0&&o===0&&i>0)continue;const c=s==null?void 0:s.find(p=>p.set_number===i+1),u=c==null?void 0:c.tiebreak_loser_points;if(i===2&&r.length===2)r.push(`STB ${n}:${o}`);else if(u!=null&&u>=0){const h=Math.max(7,u+2);let g,d;n>o?(g=h,d=u):(g=u,d=h),r.push(`${n}:${o}(${g}:${d})`)}else r.push(`${n}:${o}`)}return r.join(", ")||"–"},getHistoryAriaLabel(e){const t=this.tr().history||{},s=`${t.court||"Kort"} ${e.kort_id}`,r=`${e.player_a||"-"} ${t.vs||"vs"} ${e.player_b||"-"}`,a=[s,r];e.category&&a.push(`${t.category||"Kategoria"} ${e.category}`);const i=this.formatHistoryScore(e.score_a,e.score_b,e.sets_history);return i&&i!=="–"&&a.push(`${t.score||"wynik"} ${i}`),e.duration_seconds&&a.push(`${t.time||"czas"} ${this.formatTime(e.duration_seconds)}`),a.join(", ")},async toggleMatchDetails(e){if(!e)return;const t=String(e);if(this.expandedMatchStats[t]){delete this.expandedMatchStats[t],this.expandedMatchStats={...this.expandedMatchStats};return}try{this.expandedMatchStats={...this.expandedMatchStats,[t]:{loading:!0}};const s=await fetch(`/api/match-stats/${e}`);if(!s.ok){this.expandedMatchStats={...this.expandedMatchStats,[t]:{error:!0}};return}const r=await s.json();this.expandedMatchStats={...this.expandedMatchStats,[t]:r}}catch{this.expandedMatchStats={...this.expandedMatchStats,[t]:{error:!0}}}},isMatchExpanded(e){return e&&!!this.expandedMatchStats[String(e)]},getMatchStats(e){return e?this.expandedMatchStats[String(e)]:null},getStatsRows(e,t,s){if(!e||!e[t])return[];const r=e[t],a=e[s]||{},i=(e.stats_mode||"ADVANCED").toUpperCase(),n=this.tr().stats||{},o=[];if(i==="ADVANCED"&&o.push({label:n.aces||"Aces",value:r.aces??0}),o.push({label:n.doubleFaults||"Double faults",value:r.double_faults??0}),o.push({label:n.winners||"Winners",value:r.winners??0}),i==="ADVANCED"&&(o.push({label:n.forcedErrors||"Forced errors",value:r.forced_errors??0}),o.push({label:n.unforcedErrors||"Unforced errors",value:r.unforced_errors??0})),r.first_serves>0||r.first_serve_percentage>0){i==="ADVANCED"&&r.first_serves>0&&o.push({label:n.firstServe||"1st serve",value:`${r.first_serves_in??0}/${r.first_serves}`});const c=r.first_serve_percentage!=null?Math.round(r.first_serve_percentage)+"%":r.first_serves>0?Math.round((r.first_serves_in??0)/r.first_serves*100)+"%":"–";o.push({label:n.firstServePct||"1st serve %",value:c})}if(i==="ADVANCED"){const c=(r.aces??0)+(r.winners??0)+(a.double_faults??0)+(a.forced_errors??0)+(a.unforced_errors??0);o.push({label:n.pointsWon||"Points won",value:c})}return o}}));b.start();
