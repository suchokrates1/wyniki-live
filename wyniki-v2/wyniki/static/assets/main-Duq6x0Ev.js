import{m as k}from"./main-BUg_reD0.js";const g={pl:{htmlLang:"pl",navLabel:"Szybka nawigacja po kortach",courtLabel:"Kort {court}",liveBadge:"LIVE",versus:"vs",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Punkty",tieBreak:"Tie Break",superTieBreak:"Super TB",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Gracz A",defaultB:"Gracz B"},meta:{lastRefresh:"Ostatnie odświeżenie: {time}."},accessibility:{versus:"kontra",points:"punkty",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"aktywny"},history:{title:"Historia meczów"}},de:{htmlLang:"de",navLabel:"Schnellnavigation zu den Plätzen",courtLabel:"Platz {court}",liveBadge:"LIVE",versus:"gegen",tieBreakLabel:"TIEBREAK",superTieBreakLabel:"SUPER-TIEBREAK",table:{columns:{points:"Punkte",tieBreak:"Tiebreak",superTieBreak:"Super-Tiebreak",set1:"Satz 1",set2:"Satz 2",set3:"Satz 3"}},players:{defaultA:"Spieler A",defaultB:"Spieler B"},meta:{lastRefresh:"Letzte Aktualisierung: {time}."},accessibility:{versus:"gegen",points:"Punkte",tieBreak:"Tiebreak",superTieBreak:"Super-Tiebreak",set:"Satz {number}",active:"aktiv"},history:{title:"Match-Historie"}},en:{htmlLang:"en",navLabel:"Quick court navigation",courtLabel:"Court {court}",liveBadge:"LIVE",versus:"vs",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Points",tieBreak:"Tie-break",superTieBreak:"Super tie-break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Player A",defaultB:"Player B"},meta:{lastRefresh:"Last refresh: {time}."},accessibility:{versus:"versus",points:"points",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"active"},history:{title:"Match history"}},it:{htmlLang:"it",navLabel:"Navigazione rapida dei campi",courtLabel:"Campo {court}",liveBadge:"LIVE",versus:"contro",tieBreakLabel:"TIE-BREAK",superTieBreakLabel:"SUPER TIE-BREAK",table:{columns:{points:"Punti",tieBreak:"Tie-break",superTieBreak:"Super tie-break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Giocatore A",defaultB:"Giocatore B"},meta:{lastRefresh:"Ultimo aggiornamento: {time}."},accessibility:{versus:"contro",points:"punti",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"attivo"},history:{title:"Storico incontri"}},es:{htmlLang:"es",navLabel:"Navegación rápida por canchas",courtLabel:"Cancha {court}",liveBadge:"EN VIVO",versus:"contra",tieBreakLabel:"TIE BREAK",superTieBreakLabel:"SUPER TIE BREAK",table:{columns:{points:"Puntos",tieBreak:"Tie break",superTieBreak:"Súper tie break",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Jugador A",defaultB:"Jugador B"},meta:{lastRefresh:"Última actualización: {time}."},accessibility:{versus:"contra",points:"puntos",tieBreak:"tie-break",superTieBreak:"super tie-break",set:"Set {number}",active:"activo"},history:{title:"Historial de partidos"}},fr:{htmlLang:"fr",navLabel:"Navigation rapide des courts",courtLabel:"Court {court}",liveBadge:"EN DIRECT",versus:"contre",tieBreakLabel:"JEU DÉCISIF",superTieBreakLabel:"SUPER JEU DÉCISIF",table:{columns:{points:"Points",tieBreak:"Jeu décisif",superTieBreak:"Super jeu décisif",set1:"Set 1",set2:"Set 2",set3:"Set 3"}},players:{defaultA:"Joueur A",defaultB:"Joueur B"},meta:{lastRefresh:"Dernière mise à jour: {time}."},accessibility:{versus:"contre",points:"points",tieBreak:"jeu décisif",superTieBreak:"super jeu décisif",set:"Set {number}",active:"actif"},history:{title:"Historique des matchs"}}};function L(e){return g[e]||g.pl}function m(e,t={}){return e.replace(/\{(\w+)\}/g,(s,a)=>t[a]??`{${a}}`)}function f(e){e&&(e.classList.add("changed"),setTimeout(()=>e.classList.remove("changed"),1200))}function y(e,t,s){try{const a=String(t??""),r=String(s??""),i=Math.max(a.length,r.length),n=document.createElement("span");n.className="digits";for(let o=0;o<i;o++){const l=document.createElement("span");l.className="digit";const c=document.createElement("span");c.className="d-old",c.textContent=a[o]??"";const p=document.createElement("span");p.className="d-new",p.textContent=r[o]??"",l.append(c,p),n.appendChild(l)}e.innerHTML="",e.appendChild(n),e.classList.add("rolling"),setTimeout(()=>{e.classList.remove("rolling"),e.textContent=s},350)}catch{e.textContent=s}}function B(e){if(!e||typeof e!="object")return!1;const t=parseInt(e.A??e.a??0,10),s=parseInt(e.B??e.b??0,10);return(isNaN(t)?0:t)!==0||(isNaN(s)?0:s)!==0}window.Alpine=k;k.data("tennisApp",()=>({courts:{},prevCourts:{},loading:!0,error:null,lastUpdate:null,lang:"pl",darkMode:!1,history:[],init(){const e=localStorage.getItem("theme");(e==="dark"||!e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&(this.darkMode=!0,document.documentElement.setAttribute("data-theme","dark")),this.connectSSE(),this.fetchInitialData()},tr(){return L(this.lang)},acc(){return this.tr().accessibility||{}},t(e,t={}){const s=this.tr(),a=e.split(".").reduce((r,i)=>r==null?void 0:r[i],s);return typeof a=="string"?m(a,t):e==="setLabel"?m(this.acc().set||"Set {number}",t):e==="courtLabel"?m(s.courtLabel||"Kort {court}",t):e==="navLabel"?s.navLabel||"Nawigacja":""},onLangChange(){document.documentElement.lang=this.tr().htmlLang||this.lang},toggleDarkMode(){this.darkMode=!this.darkMode;const e=this.darkMode?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},async fetchInitialData(){try{const e=await fetch("/api/snapshot");if(!e.ok)throw new Error("Failed to fetch courts");const t=await e.json();this.courts=t.courts||{},this.loading=!1,this.lastUpdate=new Date}catch(e){this.error=e.message,this.loading=!1}},connectSSE(){const e=new EventSource("/api/stream");e.addEventListener("court_update",t=>{try{const s=JSON.parse(t.data),a=String(s.court_id),r=this.courts[a];this.$nextTick(()=>{this.animateChanges(a,r,s)}),this.prevCourts[a]=r?{...r}:{},this.courts[a]=s,this.lastUpdate=new Date}catch{}}),e.onerror=()=>{this.error="Połączenie przerwane",setTimeout(()=>this.connectSSE(),5e3)}},animateChanges(e,t,s){if(!t)return;const a=["A","B"];a.forEach(r=>{const i=this.resolveDisplayPoints(t,r),n=this.resolveDisplayPoints(s,r);if(i!==n){const o=document.getElementById(`k${e}-pts-${r}`);o&&(y(o,i,n),f(o),(n==="ADV"||n==="40")&&(o.classList.add("flip-strong"),setTimeout(()=>o.classList.remove("flip-strong"),450)))}});for(let r=1;r<=3;r++)a.forEach(i=>{var c,p;const n=`set${r}`,o=(c=t[i])==null?void 0:c[n],l=(p=s[i])==null?void 0:p[n];if(l!==void 0&&l!==o){const u=document.getElementById(`k${e}-s${r}-${i}`);u&&f(u)}});a.forEach(r=>{var o,l,c,p;const i=((o=t[r])==null?void 0:o.full_name)||((l=t[r])==null?void 0:l.surname),n=((c=s[r])==null?void 0:c.full_name)||((p=s[r])==null?void 0:p.surname);if(n&&i!==n){const u=document.getElementById(`k${e}-name-${r}`);u&&f(u)}})},resolveDisplayPoints(e,t){var i;if(!e)return"0";const s=e.tie||{};if(B(s)){const n=s[t]??s[t.toLowerCase()];return n!=null?String(n):"0"}const r=(i=e[t])==null?void 0:i.points;return r!=null?String(r):"0"},getCourtIds(){return Object.keys(this.courts).map(e=>parseInt(e)).filter(e=>!isNaN(e)&&e>0).sort((e,t)=>e-t).map(e=>e.toString())},hasActiveCourts(){return Object.values(this.courts).some(e=>{var t;return(t=e.match_status)==null?void 0:t.active})},isMatchActive(e){var t,s;return((s=(t=this.courts[e])==null?void 0:t.match_status)==null?void 0:s.active)||!1},getPlayerName(e,t){var r;const s=(r=this.courts[e])==null?void 0:r[t];if(s){const i=s.full_name;if(i&&String(i).trim())return String(i).trim();const n=s.surname;if(n&&n!=="-")return n}const a=this.tr();return t==="A"?a.players.defaultA:a.players.defaultB},getHeadingAria(e){const t=this.t("courtLabel",{court:e}),s=this.getPlayerName(e,"A"),a=this.getPlayerName(e,"B"),r=this.acc().versus||"kontra";return`${t}: ${s} ${r} ${a}`},isTiebreak(e){var s;const t=(s=this.courts[e])==null?void 0:s.tie;return B(t)},isSuperTiebreak(e){const t=this.courts[e];return t?this.isTiebreak(e)&&(t.current_set===3||t.current_set==="3"):!1},getDisplayPoints(e,t){return this.resolveDisplayPoints(this.courts[e],t)},getPointsLabel(e){var a;const s=((a=this.tr().table)==null?void 0:a.columns)||{};return this.isSuperTiebreak(e)?s.superTieBreak||"Super TB":this.isTiebreak(e)?s.tieBreak||"Tie Break":s.points||"Punkty"},getSetIndices(e){var r,i;const t=this.courts[e];if(!t)return[1,2];const s=parseInt(t.current_set)||1,a=[1,2];return(s>=3||(r=t.A)!=null&&r.set3||(i=t.B)!=null&&i.set3)&&a.push(3),a},getSetScore(e,t,s){var i;const a=this.courts[e];if(!a)return"0";const r=(i=a[t])==null?void 0:i[`set${s}`];return r!=null?String(r):"0"},getScoreSummary(e){const t=this.courts[e];if(!t)return"";const s=this.acc(),a=this.isTiebreak(e),r=this.isSuperTiebreak(e),i=parseInt(t.current_set)||1,n=a?r?s.superTieBreak||"super tie-break":s.tieBreak||"tie-break":s.points||"punkty",o=this.getDisplayPoints(e,"A"),l=this.getDisplayPoints(e,"B"),c=[`${n} ${o}:${l}`];return this.getSetIndices(e).forEach(u=>{const h=this.getSetScore(e,"A",u),d=this.getSetScore(e,"B",u),S=parseInt(h)||0,v=parseInt(d)||0;if(!(u===1||i>=u||S>0||v>0))return;const b=m(s.set||"Set {number}",{number:u}),T=i===u?`${b}, ${s.active||"aktywny"}, ${h}:${d}`:`${b} ${h}:${d}`;c.push(T)}),c.join(". ").trim()},getScore(e,t){const s=this.courts[e];if(!s)return{sets:[],points:"-"};const a=s[t];return a?{sets:a.sets||[],points:a.points||"0"}:{sets:[],points:"-"}},formatTime(e){if(!e)return"";const t=Math.floor(e/60),s=e%60;return`${t}:${s.toString().padStart(2,"0")}`}}));k.start();
