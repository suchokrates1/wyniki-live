import{m as r}from"./main-DtaNp4HT.js";window.Alpine=r;r.data("adminApp",()=>({activeTab:"courts",courts:[],newCourtId:"",newCourtPin:"",editingCourt:null,editCourtId:"",tournaments:[],selectedTournament:null,newTournament:{name:"",start_date:"",end_date:""},players:[],newPlayer:{name:"",category:"",country:""},importText:"",overlaySettings:{courts_visible:{1:!0,2:!0,3:!0,4:!0},auto_hide:!1,show_stats:!1},loading:{courts:!1,tournaments:!1,players:!1},toast:{show:!1,message:"",type:"info"},get filteredPlayers(){return this.players},init(){this.loadCourts(),this.loadTournaments(),this.loadOverlaySettings()},showToast(t,e="info"){this.toast={show:!0,message:t,type:e},setTimeout(()=>{this.toast.show=!1},3e3)},async loadCourts(){this.loading.courts=!0;try{const t=await fetch("/admin/api/courts");if(!t.ok)throw new Error("Failed to load courts");this.courts=await t.json()}catch(t){console.error("Failed to load courts:",t),this.showToast("Błąd ładowania kortów","error")}finally{this.loading.courts=!1}},async refreshCourts(){await this.loadCourts(),this.showToast("Korty odświeżone","success")},async updateCourtPin(t,e){try{if(e&&(e.length!==4||!/^\d{4}$/.test(e))){this.showToast("PIN musi mieć 4 cyfry","warning"),await this.loadCourts();return}if(!(await fetch(`/admin/api/courts/${t}/pin`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({pin:e||null})})).ok)throw new Error("Failed to update PIN");this.showToast(`PIN dla kortu ${t} zaktualizowany`,"success"),await this.loadCourts()}catch(s){console.error("Failed to update PIN:",s),this.showToast("Błąd aktualizacji PIN","error")}},async addCourt(){if(!this.newCourtId){this.showToast("Wprowadź ID kortu","warning");return}if(this.newCourtPin&&(this.newCourtPin.length!==4||!/^\d{4}$/.test(this.newCourtPin))){this.showToast("PIN musi mieć 4 cyfry","warning");return}try{if(!(await fetch("/admin/api/courts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({kort_id:this.newCourtId,pin:this.newCourtPin||null})})).ok)throw new Error("Failed to add court");this.showToast(`Kort ${this.newCourtId} dodany`,"success"),this.newCourtId="",this.newCourtPin="",await this.loadCourts()}catch(t){console.error("Failed to add court:",t),this.showToast("Błąd dodawania kortu","error")}},startEdit(t){this.editingCourt=t,this.editCourtId=t},cancelEdit(){this.editingCourt=null,this.editCourtId=""},async saveCourt(t){if(!this.editCourtId){this.showToast("ID kortu nie może być puste","warning");return}if(this.editCourtId===t){this.cancelEdit();return}try{const e=await fetch(`/admin/api/courts/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({kort_id:this.editCourtId})});if(!e.ok){const s=await e.json();throw new Error(s.error||"Failed to rename court")}this.showToast(`Kort ${t} zmieniono na ${this.editCourtId}`,"success"),this.cancelEdit(),await this.loadCourts()}catch(e){console.error("Failed to rename court:",e),this.showToast(e.message||"Błąd zmiany nazwy kortu","error")}},async deleteCourt(t){if(confirm(`Czy na pewno chcesz usunąć Kort ${t}?`))try{if(!(await fetch(`/admin/api/courts/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete court");this.showToast(`Kort ${t} usunięty`,"success"),await this.loadCourts()}catch(e){console.error("Failed to delete court:",e),this.showToast("Błąd usuwania kortu","error")}},async loadTournaments(){this.loading.tournaments=!0;try{const t=await fetch("/admin/api/tournaments");if(!t.ok)throw new Error("Failed to load tournaments");if(this.tournaments=await t.json(),!this.selectedTournament){const e=this.tournaments.find(s=>s.active);e&&(this.selectedTournament=e.id,await this.loadPlayers(e.id))}}catch(t){console.error("Failed to load tournaments:",t),this.showToast("Błąd ładowania turniejów","error")}finally{this.loading.tournaments=!1}},async createTournament(){if(!this.newTournament.name||!this.newTournament.start_date||!this.newTournament.end_date){this.showToast("Wypełnij wszystkie pola","warning");return}try{if(!(await fetch("/admin/api/tournaments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newTournament)})).ok)throw new Error("Failed to create tournament");this.showToast("Turniej utworzony","success"),this.newTournament={name:"",start_date:"",end_date:""},await this.loadTournaments()}catch(t){console.error("Failed to create tournament:",t),this.showToast("Błąd tworzenia turnieju","error")}},async deleteTournament(t){if(confirm("Czy na pewno usunąć ten turniej?"))try{if(!(await fetch(`/admin/api/tournaments/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete tournament");this.showToast("Turniej usunięty","success"),await this.loadTournaments()}catch(e){console.error("Failed to delete tournament:",e),this.showToast("Błąd usuwania turnieju","error")}},async activateTournament(t){try{if(!(await fetch(`/admin/api/tournaments/${t}/activate`,{method:"POST"})).ok)throw new Error("Failed to activate tournament");this.showToast("Turniej aktywowany","success"),await this.loadTournaments()}catch(e){console.error("Failed to activate tournament:",e),this.showToast("Błąd aktywacji turnieju","error")}},async selectTournament(t){this.selectedTournament=t,this.activeTab="players",await this.loadPlayers(t)},async loadPlayers(t){if(t){this.loading.players=!0;try{const e=await fetch(`/admin/api/tournaments/${t}/players`);if(!e.ok)throw new Error("Failed to load players");this.players=await e.json()}catch(e){console.error("Failed to load players:",e),this.showToast("Błąd ładowania graczy","error")}finally{this.loading.players=!1}}},async addPlayer(){if(!this.selectedTournament||!this.newPlayer.name){this.showToast("Wprowadź imię i nazwisko gracza","warning");return}try{if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newPlayer)})).ok)throw new Error("Failed to add player");this.showToast("Gracz dodany","success"),this.newPlayer={name:"",category:"",country:""},await this.loadPlayers(this.selectedTournament)}catch(t){console.error("Failed to add player:",t),this.showToast("Błąd dodawania gracza","error")}},async deletePlayer(t){if(confirm("Czy na pewno usunąć tego gracza?"))try{if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete player");this.showToast("Gracz usunięty","success"),await this.loadPlayers(this.selectedTournament)}catch(e){console.error("Failed to delete player:",e),this.showToast("Błąd usuwania gracza","error")}},async importPlayers(){if(!this.selectedTournament||!this.importText.trim()){this.showToast("Wprowadź dane graczy","warning");return}try{const e=this.importText.trim().split(`
`).filter(a=>a.trim()).map(a=>{const o=a.trim().split(/\s+/),i=o.slice(0,-2).join(" ")||o.join(" "),n=o[o.length-2]||"",h=o[o.length-1]||"";return{name:i,category:n,country:h}});if(!(await fetch(`/admin/api/tournaments/${this.selectedTournament}/players/bulk`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({players:e})})).ok)throw new Error("Failed to import players");this.showToast(`Zaimportowano ${e.length} graczy`,"success"),this.importText="",await this.loadPlayers(this.selectedTournament)}catch(t){console.error("Failed to import players:",t),this.showToast("Błąd importu graczy","error")}},async loadOverlaySettings(){try{const t=await fetch("/api/overlay/settings");t.ok&&(this.overlaySettings=await t.json())}catch(t){console.error("Failed to load overlay settings:",t)}},async saveOverlaySettings(){try{const t=await fetch("/api/overlay/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.overlaySettings)});if(!t.ok)throw new Error("Failed to save settings");this.overlaySettings=await t.json()}catch(t){console.error("Failed to save overlay settings:",t),this.showToast("Błąd zapisu ustawień overlay","error")}},async toggleCourt(t){this.overlaySettings.courts_visible[t]=!this.overlaySettings.courts_visible[t],await this.saveOverlaySettings();const e=this.overlaySettings.courts_visible[t]?"widoczny":"ukryty";this.showToast(`Kort ${t}: ${e}`,"success")},async toggleAutoHide(){this.overlaySettings.auto_hide=!this.overlaySettings.auto_hide,await this.saveOverlaySettings(),this.showToast(this.overlaySettings.auto_hide?"Autoukrywanie włączone":"Autoukrywanie wyłączone","success")},async toggleShowStats(){this.overlaySettings.show_stats=!this.overlaySettings.show_stats,await this.saveOverlaySettings(),this.showToast(this.overlaySettings.show_stats?"Statystyki włączone":"Statystyki wyłączone","success")},getOverlayUrl(t){const e=window.location.origin;return t==="all"?`${e}/overlay/all`:`${e}/overlay/${t}`},async copyUrl(t){try{await navigator.clipboard.writeText(t),this.showToast("URL skopiowany do schowka","success")}catch{const s=document.createElement("textarea");s.value=t,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),this.showToast("URL skopiowany","success")}}}));r.start();
