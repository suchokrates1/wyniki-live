<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyniki tenisowe ‚Äì na ≈ºywo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>üéæ</text></svg>">
    <meta name="description" content="Live tennis scores - wyniki na ≈ºywo">
</head>
<body>
    <div x-data="tennisApp" x-cloak class="wrap" x-effect="document.title = tr().pageTitle || 'Wyniki tenisowe ‚Äì na ≈ºywo'">
        
        <!-- Header -->
        <header class="header">
            <div class="header-bar">
                <h1 class="header-title">
                    Wyniki tenisowe ‚Äì na ≈ºywo
                    <span x-show="hasActiveCourts()" class="live-badge">LIVE</span>
                </h1>
                <div class="header-actions">
                    <label class="sr-only" for="langSelect">Wybierz jƒôzyk</label>
                    <select id="langSelect" class="lang-select" x-model="lang" @change="onLangChange()">
                        <option value="pl">Polski</option>
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                        <option value="it">Italiano</option>
                        <option value="es">Espa√±ol</option>
                        <option value="fr">Fran√ßais</option>
                    </select>
                    <button class="dark-mode-toggle" @click="toggleDarkMode()" :aria-label="darkMode ? 'Tryb jasny' : 'Tryb ciemny'">
                        <span class="dark-mode-toggle__icon" aria-hidden="true" x-text="darkMode ? '‚òÄÔ∏è' : 'üåô'"></span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Quick court navigation -->
        <nav x-show="getCourtIds().length > 0" :aria-label="t('navLabel')">
            <ul>
                <template x-for="courtId in getCourtIds()" :key="'nav-'+courtId">
                    <li><a :href="'#kort-'+courtId" x-text="t('courtLabel', {court: courtId})"></a></li>
                </template>
            </ul>
        </nav>
        
        <!-- Loading State -->
        <div x-show="loading" class="loading-state" role="status">
            <span class="spinner spinner--large"></span>
            <span class="sr-only">≈Åadowanie wynik√≥w...</span>
        </div>
        
        <!-- Error State -->
        <div x-show="error && !loading" class="error-bar" role="alert" aria-live="assertive">
            <span class="error" x-text="error"></span>
        </div>

        <!-- Main content -->
        <main id="main" tabindex="-1">
            <!-- Empty State -->
            <div x-show="!loading && getCourtIds().length === 0" class="empty-state">
                <div class="empty-state__icon">üéæ</div>
                <h2 class="empty-state__title">Brak aktywnych kort√≥w</h2>
                <p class="empty-state__text">Skonfiguruj korty w panelu administratora</p>
            </div>
            
            <!-- Courts Grid -->
            <div x-show="!loading" class="grid">
                <template x-for="courtId in getCourtIds()" :key="courtId">
                    <section class="card" :id="'kort-'+courtId" :aria-labelledby="'heading-'+courtId">
                        
                        <!-- Card Header -->
                        <div class="card-head">
                            <h2 :id="'heading-'+courtId"
                                :aria-label="getHeadingAria(courtId)">
                                <span class="court-label" x-text="t('courtLabel', {court: courtId})"></span>:
                                <span class="match-title">
                                    <span class="match-player" x-text="getPlayerName(courtId, 'A')"></span>
                                    <span class="match-versus">
                                        <span aria-hidden="true" x-text="tr().versus || 'vs'"></span>
                                        <span class="sr-only" x-text="acc().versus"></span>
                                    </span>
                                    <span class="match-player" x-text="getPlayerName(courtId, 'B')"></span>
                                </span>
                                <span x-show="isMatchActive(courtId)" class="live-badge" x-text="tr().liveBadge || 'LIVE'"></span>
                            </h2>
                        </div>

                        <!-- Scoreboard -->
                        <div class="score-wrapper">
                            <!-- Tiebreak labels (above scoreboard) -->
                            <div class="score-labels">
                                <div class="score-label score-label-tb"
                                     :class="{ 'is-visible': isTiebreak(courtId) && !isSuperTiebreak(courtId) }"
                                     aria-hidden="true" x-text="tr().tieBreakLabel || 'TIE-BREAK'"></div>
                                <div class="score-label score-label-stb"
                                     :class="{ 'is-visible': isSuperTiebreak(courtId) }"
                                     aria-hidden="true" x-text="tr().superTieBreakLabel || 'SUPER TIE-BREAK'"></div>
                            </div>

                            <!-- Score table (visual, hidden from screen readers) -->
                            <dl class="score-list" aria-hidden="true">
                                <!-- Player A -->
                                <div class="score-row" data-side="A">
                                    <dt class="player-cell">
                                        <span class="player-flag has-image" aria-hidden="true"
                                              x-show="courts[courtId]?.A?.flag_url || courts[courtId]?.A?.flag_code"
                                              :style="'background-image:url('+(courts[courtId]?.A?.flag_url || codeToFlag(courts[courtId]?.A?.flag_code))+')'">
                                        </span>
                                        <span class="player-name" :id="'k'+courtId+'-name-A'" x-text="getPlayerName(courtId, 'A')"></span>
                                        <span class="serve-indicator" x-show="courts[courtId]?.serve === 'A'" aria-hidden="true"><img src="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 36 36%27%3E%3Ccircle cx=%2718%27 cy=%2718%27 r=%2717%27 fill=%27%23C6E953%27/%3E%3Ccircle cx=%2718%27 cy=%2718%27 r=%2717%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3Cpath d=%27M5 11c4 8 14 14 26 6%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3Cpath d=%27M5 25c6-8 16-14 26-6%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3C/svg%3E" alt="serve" style="width:14px;height:14px;"></span>
                                    </dt>
                                    <dd class="metric points" :aria-labelledby="'k'+courtId+'-label-points k'+courtId+'-name-A'">
                                        <span class="metric-label" :id="'k'+courtId+'-label-points'"
                                              x-text="getPointsLabel(courtId)"></span>
                                        <span class="metric-value points"
                                              :id="'k'+courtId+'-pts-A'"
                                              :class="{ 'is-tiebreak': isTiebreak(courtId) }"
                                              x-text="getDisplayPoints(courtId, 'A')"></span>
                                    </dd>
                                    <template x-for="setIdx in getSetIndices(courtId)" :key="'sA'+setIdx">
                                        <dd class="metric" :class="'set-'+setIdx"
                                            :aria-labelledby="'k'+courtId+'-label-set'+setIdx+' k'+courtId+'-name-A'">
                                            <span class="metric-label" :id="'k'+courtId+'-label-set'+setIdx"
                                                  x-text="t('setLabel', {number: setIdx})"
                                                  x-show="$el.closest('.score-row[data-side=A]')"></span>
                                            <span class="metric-value set"
                                                  :id="'k'+courtId+'-s'+setIdx+'-A'"
                                                  :class="{ 'is-active': courts[courtId]?.current_set == setIdx }"
                                                  x-text="getSetScore(courtId, 'A', setIdx)"></span>
                                        </dd>
                                    </template>
                                </div>

                                <!-- Player B -->
                                <div class="score-row" data-side="B">
                                    <dt class="player-cell">
                                        <span class="player-flag has-image" aria-hidden="true"
                                              x-show="courts[courtId]?.B?.flag_url || courts[courtId]?.B?.flag_code"
                                              :style="'background-image:url('+(courts[courtId]?.B?.flag_url || codeToFlag(courts[courtId]?.B?.flag_code))+')'">
                                        </span>
                                        <span class="player-name" :id="'k'+courtId+'-name-B'" x-text="getPlayerName(courtId, 'B')"></span>
                                        <span class="serve-indicator" x-show="courts[courtId]?.serve === 'B'" aria-hidden="true"><img src="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 36 36%27%3E%3Ccircle cx=%2718%27 cy=%2718%27 r=%2717%27 fill=%27%23C6E953%27/%3E%3Ccircle cx=%2718%27 cy=%2718%27 r=%2717%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3Cpath d=%27M5 11c4 8 14 14 26 6%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3Cpath d=%27M5 25c6-8 16-14 26-6%27 fill=%27none%27 stroke=%27%23fff%27 stroke-width=%272%27/%3E%3C/svg%3E" alt="serve" style="width:14px;height:14px;"></span>
                                    </dt>
                                    <dd class="metric points" :aria-labelledby="'k'+courtId+'-label-points k'+courtId+'-name-B'">
                                        <span class="metric-value points"
                                              :id="'k'+courtId+'-pts-B'"
                                              :class="{ 'is-tiebreak': isTiebreak(courtId) }"
                                              x-text="getDisplayPoints(courtId, 'B')"></span>
                                    </dd>
                                    <template x-for="setIdx in getSetIndices(courtId)" :key="'sB'+setIdx">
                                        <dd class="metric" :class="'set-'+setIdx"
                                            :aria-labelledby="'k'+courtId+'-label-set'+setIdx+' k'+courtId+'-name-B'">
                                            <span class="metric-value set"
                                                  :id="'k'+courtId+'-s'+setIdx+'-B'"
                                                  :class="{ 'is-active': courts[courtId]?.current_set == setIdx }"
                                                  x-text="getSetScore(courtId, 'B', setIdx)"></span>
                                        </dd>
                                    </template>
                                </div>
                            </dl>
                        </div>

                        <!-- Screen reader summary (hidden visually, read by screen readers) -->
                        <p class="sr-only score-summary" :id="'k'+courtId+'-summary'" aria-live="polite"
                           x-text="getScoreSummary(courtId)"></p>

                        <!-- Match info footer -->
                        <div class="card-footer" x-show="isMatchActive(courtId)">
                            <span class="match-time" x-show="courts[courtId]?.match_time?.seconds">
                                üïí <span x-text="formatTime(courts[courtId]?.match_time?.seconds)"></span>
                            </span>
                            <span class="match-set" x-text="'Set ' + (courts[courtId]?.current_set || 1)"></span>
                        </div>
                    </section>
                </template>
            </div>
        </main>

        <!-- Meta -->
        <div class="meta">
            <span x-show="lastUpdate" x-text="(tr().meta?.lastRefresh || 'Ostatnia aktualizacja: {time}').replace('{time}', lastUpdate ? lastUpdate.toLocaleTimeString('pl-PL') : '')"></span>
        </div>

        <!-- History Section -->
        <section id="history-section" x-show="history.length > 0" aria-labelledby="history-title">
            <h3 id="history-title" class="history-title" x-text="tr().history?.title || 'Historia mecz√≥w'"></h3>
            <div id="history-body" class="history-list" role="list">
                <template x-for="match in history" :key="match.id">
                    <article class="history-item" role="listitem"
                             :aria-label="getHistoryAriaLabel(match)">
                        <!-- Main row: court, players, score, category, time -->
                        <div class="history-main" aria-hidden="true">
                            <span class="history-court" x-text="'Kort ' + match.kort_id"></span>
                            <span class="history-players">
                                <strong x-text="match.player_a || '-'"></strong>
                                <span class="history-vs">vs</span>
                                <strong x-text="match.player_b || '-'"></strong>
                            </span>
                            <span class="history-score" x-text="formatHistoryScore(match.score_a, match.score_b)"></span>
                            <span class="history-category" x-show="match.category" x-text="match.category"></span>
                            <span class="history-duration" x-show="match.duration_seconds" x-text="formatTime(match.duration_seconds)"></span>
                            <button class="history-details-btn"
                                    x-show="match.match_id"
                                    @click="toggleMatchDetails(match.match_id)"
                                    :aria-expanded="isMatchExpanded(match.match_id)"
                                    x-text="isMatchExpanded(match.match_id) ? (tr().historyDetail?.collapse || 'Zwi≈Ñ') : (tr().historyDetail?.details || 'Szczeg√≥≈Çy')">
                            </button>
                        </div>

                        <!-- Details panel (expandable stats) -->
                        <div class="history-stats-panel" x-show="isMatchExpanded(match.match_id)" x-transition>
                            <template x-if="getMatchStats(match.match_id)?.loading">
                                <div class="stats-loading" x-text="tr().historyDetail?.loading || '≈Åadowanie...'"></div>
                            </template>
                            <template x-if="getMatchStats(match.match_id)?.error">
                                <div class="stats-error" x-text="tr().historyDetail?.noStats || 'Brak statystyk'"></div>
                            </template>
                            <template x-if="getMatchStats(match.match_id)?.player1_stats">
                                <div class="stats-grid">
                                    <div class="stats-column">
                                        <h4 class="stats-player-name" x-text="match.player_a || 'Gracz A'"></h4>
                                        <template x-for="row in getStatsRows(getMatchStats(match.match_id), 'player1_stats')" :key="row.label">
                                            <div class="stats-row">
                                                <span class="stats-label" x-text="row.label"></span>
                                                <span class="stats-value" x-text="row.value"></span>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="stats-column">
                                        <h4 class="stats-player-name" x-text="match.player_b || 'Gracz B'"></h4>
                                        <template x-for="row in getStatsRows(getMatchStats(match.match_id), 'player2_stats')" :key="row.label">
                                            <div class="stats-row">
                                                <span class="stats-label" x-text="row.label"></span>
                                                <span class="stats-value" x-text="row.value"></span>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="stats-winner" x-show="getMatchStats(match.match_id)?.winner">
                                        üèÜ <span x-text="getMatchStats(match.match_id)?.winner"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </article>
                </template>
            </div>
        </section>

        <!-- Vestmedia Footer -->
        <footer class="vm-footer">
            <span>Powered by</span>
            <a href="https://vestmedia.pl" target="_blank" rel="noopener noreferrer" class="vm-footer__link">
                <img src="https://vestmedia.pl/wp-content/uploads/2024/12/Vest-Media-5.png"
                     alt="Vest Media" class="vm-footer__logo" loading="lazy">
            </a>
        </footer>
    </div>
    
    <script type="module" src="/src/main.js"></script>
</body>
</html>
