<!DOCTYPE html>
<html lang="pl" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Administracyjny - Wyniki Live</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>ðŸŽ¾</text></svg>">
</head>
<body class="min-h-screen bg-base-200">
  <div x-data="adminApp" class="container mx-auto px-4 py-8 max-w-7xl">
    
    <header class="mb-8">
      <div class="flex justify-between items-center">
        <h1 class="text-4xl font-bold">ðŸŽ¾ Panel Administracyjny</h1>
        <div class="flex gap-2">
          <button @click="activeTab = 'uno'" :class="{'btn-primary': activeTab === 'uno'}" class="btn btn-sm">UNO Throttling</button>
          <button @click="activeTab = 'courts'" :class="{'btn-primary': activeTab === 'courts'}" class="btn btn-sm">Korty</button>
          <button @click="activeTab = 'tournaments'" :class="{'btn-primary': activeTab === 'tournaments'}" class="btn btn-sm">Turnieje</button>
          <button @click="activeTab = 'history'" :class="{'btn-primary': activeTab === 'history'}" class="btn btn-sm">Historia</button>
        </div>
      </div>
    </header>

    <!-- UNO Throttling Tab -->
    <div x-show="activeTab === 'uno'" x-cloak>
      <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
          <h2 class="card-title">Konfiguracja UNO Throttling</h2>
          
          <div class="alert" :class="unoStatus.enabled ? 'alert-success' : 'alert-warning'">
            <span x-text="unoStatus.enabled ? 'âœ“ UNO zapytania wÅ‚Ä…czone' : 'âš  UNO zapytania wyÅ‚Ä…czone'"></span>
            <button @click="toggleUno()" class="btn btn-sm" x-text="unoStatus.enabled ? 'WyÅ‚Ä…cz' : 'WÅ‚Ä…cz'"></button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text">Limit zapytaÅ„/godzinÄ™ (na kort)</span>
              </label>
              <input type="number" v-model.number="unoConfig.limit" class="input input-bordered" min="0">
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">PrÃ³g spowolnienia (%)</span>
              </label>
              <input type="number" v-model.number="unoConfig.threshold" class="input input-bordered" min="0" max="100" step="5">
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">WspÃ³Å‚czynnik spowolnienia</span>
              </label>
              <input type="number" v-model.number="unoConfig.slowdown_factor" class="input input-bordered" min="1" step="0.5">
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text">Sleep przy spowolnieniu (s)</span>
              </label>
              <input type="number" v-model.number="unoConfig.slowdown_sleep" class="input input-bordered" min="0" step="0.1">
            </div>
          </div>

          <div class="card-actions justify-end mt-4">
            <button @click="saveUnoConfig()" class="btn btn-primary">Zapisz konfiguracjÄ™</button>
          </div>
        </div>
      </div>

      <!-- UNO Status per Court -->
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Status zapytaÅ„ UNO</h2>
          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Kort</th>
                  <th>Zapytania/h</th>
                  <th>Limit</th>
                  <th>PozostaÅ‚o</th>
                  <th>Status</th>
                  <th>Reset</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="[kortId, status] in Object.entries(unoCourtStatus)" :key="kortId">
                  <tr>
                    <td x-text="'Kort ' + kortId"></td>
                    <td x-text="status.count"></td>
                    <td x-text="status.limit"></td>
                    <td x-text="status.remaining"></td>
                    <td>
                      <span class="badge" 
                            :class="{
                              'badge-success': status.mode === 'normal',
                              'badge-warning': status.mode === 'slowdown',
                              'badge-error': status.mode === 'limit',
                              'badge-ghost': status.mode === 'disabled'
                            }"
                            x-text="status.mode"></span>
                    </td>
                    <td x-text="formatResetTime(status.next_reset)"></td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Courts Tab -->
    <div x-show="activeTab === 'courts'" x-cloak>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">ZarzÄ…dzanie kortami</h2>
          
          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>ID Kortu</th>
                  <th>Overlay ID</th>
                  <th>Akcje</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="court in courts" :key="court.kort_id">
                  <tr>
                    <td x-text="'Kort ' + court.kort_id"></td>
                    <td>
                      <input type="text" 
                             :value="court.overlay_id || ''" 
                             @change="updateCourtOverlay(court.kort_id, $event.target.value)"
                             class="input input-sm input-bordered"
                             placeholder="Brak overlay">
                    </td>
                    <td>
                      <button @click="testCourt(court.kort_id)" class="btn btn-sm btn-ghost">Test</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>

          <div class="mt-4">
            <button @click="addCourt()" class="btn btn-primary btn-sm">+ Dodaj kort</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tournaments Tab -->
    <div x-show="activeTab === 'tournaments'" x-cloak>
      
      <!-- Add Tournament Form -->
      <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
          <h2 class="card-title">Dodaj nowy turniej</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="form-control">
              <label class="label"><span class="label-text">Nazwa turnieju</span></label>
              <input type="text" x-model="newTournament.name" class="input input-bordered" placeholder="np. IPC WÅ‚ochy 2025">
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Data rozpoczÄ™cia</span></label>
              <input type="date" x-model="newTournament.start_date" class="input input-bordered">
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Data zakoÅ„czenia</span></label>
              <input type="date" x-model="newTournament.end_date" class="input input-bordered">
            </div>
          </div>

          <div class="card-actions justify-end mt-4">
            <button @click="createTournament()" class="btn btn-primary">UtwÃ³rz turniej</button>
          </div>
        </div>
      </div>

      <!-- Tournaments List -->
      <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
          <h2 class="card-title">Lista turniejÃ³w</h2>
          
          <div class="overflow-x-auto">
            <table class="table table-zebra">
              <thead>
                <tr>
                  <th>Nazwa</th>
                  <th>RozpoczÄ™cie</th>
                  <th>ZakoÅ„czenie</th>
                  <th>Status</th>
                  <th>Akcje</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="tournament in tournaments" :key="tournament.id">
                  <tr :class="{'bg-success bg-opacity-10': tournament.active}">
                    <td>
                      <span class="font-semibold" x-text="tournament.name"></span>
                      <span v-if="tournament.active" class="badge badge-success badge-sm ml-2">Aktywny</span>
                    </td>
                    <td x-text="tournament.start_date"></td>
                    <td x-text="tournament.end_date"></td>
                    <td>
                      <span v-if="!tournament.active" @click="activateTournament(tournament.id)" class="badge badge-ghost badge-sm cursor-pointer hover:badge-primary">Ustaw aktywny</span>
                    </td>
                    <td class="flex gap-2">
                      <button @click="selectTournament(tournament.id)" class="btn btn-xs btn-ghost">ðŸ“‹ Gracze</button>
                      <button @click="deleteTournament(tournament.id)" class="btn btn-xs btn-error">UsuÅ„</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>

          <div class="alert alert-info mt-4" x-show="tournaments.length === 0">
            <span>Brak turniejÃ³w. Dodaj pierwszy turniej powyÅ¼ej.</span>
          </div>
        </div>
      </div>

      <!-- Players Management -->
      <div class="card bg-base-100 shadow-xl" x-show="selectedTournament">
        <div class="card-body">
          <h2 class="card-title">Gracze w turnieju</h2>
          
          <!-- Add Player Form -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
            <div class="form-control">
              <label class="label"><span class="label-text">ImiÄ™ i nazwisko</span></label>
              <input type="text" x-model="newPlayer.name" class="input input-bordered input-sm" placeholder="Jan Kowalski">
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Kategoria</span></label>
              <input type="text" x-model="newPlayer.category" class="input input-bordered input-sm" placeholder="B1">
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">Kraj</span></label>
              <input type="text" x-model="newPlayer.country" class="input input-bordered input-sm" placeholder="pl" maxlength="2">
            </div>
            <div class="form-control">
              <label class="label"><span class="label-text">&nbsp;</span></label>
              <button @click="addPlayer()" class="btn btn-primary btn-sm">Dodaj gracza</button>
            </div>
          </div>

          <!-- Bulk Import -->
          <div class="collapse collapse-arrow bg-base-200 mb-4">
            <input type="checkbox" />
            <div class="collapse-title font-medium">
              ðŸ“¥ Import graczy z pliku tekstowego
            </div>
            <div class="collapse-content">
              <p class="text-sm mb-2">Format: <code>ImiÄ™ Nazwisko Kategoria Kraj</code> (jeden gracz na liniÄ™)</p>
              <textarea x-model="importText" class="textarea textarea-bordered w-full" rows="6" placeholder="John Doe B1 us&#10;Jane Smith B2 ca&#10;..."></textarea>
              <button @click="importPlayers()" class="btn btn-primary btn-sm mt-2">Importuj graczy</button>
            </div>
          </div>

          <!-- Players Table -->
          <div class="overflow-x-auto">
            <table class="table table-zebra table-sm">
              <thead>
                <tr>
                  <th>ImiÄ™ i nazwisko</th>
                  <th>Kategoria</th>
                  <th>Kraj</th>
                  <th>Akcje</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="player in players" :key="player.id">
                  <tr>
                    <td x-text="player.name"></td>
                    <td><span class="badge badge-sm" x-text="player.category"></span></td>
                    <td x-text="player.country"></td>
                    <td>
                      <button @click="deletePlayer(player.id)" class="btn btn-xs btn-error">UsuÅ„</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>

          <div class="alert alert-info mt-4" x-show="players.length === 0">
            <span>Brak graczy w tym turnieju</span>
          </div>

          <div class="stats stats-vertical lg:stats-horizontal shadow mt-4">
            <div class="stat">
              <div class="stat-title">Liczba graczy</div>
              <div class="stat-value" x-text="players.length"></div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- History Tab -->
    <div x-show="activeTab === 'history'" x-cloak>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h2 class="card-title">Historia meczÃ³w</h2>
          
          <div class="overflow-x-auto">
            <table class="table table-zebra table-sm">
              <thead>
                <tr>
                  <th>Kort</th>
                  <th>Gracz A</th>
                  <th>Wynik</th>
                  <th>Gracz B</th>
                  <th>Czas</th>
                  <th>Faza</th>
                  <th>Akcje</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="(match, idx) in history" :key="idx">
                  <tr>
                    <td x-text="match.kort_id"></td>
                    <td x-text="match.player_a"></td>
                    <td>
                      <span x-text="formatScore(match.score_a)"></span>
                      :
                      <span x-text="formatScore(match.score_b)"></span>
                    </td>
                    <td x-text="match.player_b"></td>
                    <td x-text="match.duration"></td>
                    <td x-text="match.phase"></td>
                    <td>
                      <button @click="deleteMatch(idx)" class="btn btn-xs btn-error">UsuÅ„</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>

          <div class="alert alert-info mt-4" x-show="history.length === 0">
            <span>Brak historii meczÃ³w</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast notifications -->
    <div class="toast toast-end" x-show="toast.show" x-cloak>
      <div class="alert" :class="'alert-' + toast.type">
        <span x-text="toast.message"></span>
      </div>
    </div>


  </div>

  <script type="module" src="/src/admin.js"></script>
</body>
</html>
